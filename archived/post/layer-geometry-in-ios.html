<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>iOS 图层几何学 | 张不坏的博客</title>
    <meta name="description" content="Just For Fun">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.37bfab3d.css" as="style"><link rel="preload" href="/assets/js/app.50bca889.js" as="script"><link rel="preload" href="/assets/js/5.081d1701.js" as="script"><link rel="preload" href="/assets/js/76.d5b4df24.js" as="script"><link rel="preload" href="/assets/js/4.a7413ce2.js" as="script"><link rel="prefetch" href="/assets/js/10.7bb33f06.js"><link rel="prefetch" href="/assets/js/100.014ff06c.js"><link rel="prefetch" href="/assets/js/101.28f11de0.js"><link rel="prefetch" href="/assets/js/102.be9d2e87.js"><link rel="prefetch" href="/assets/js/103.a1210d81.js"><link rel="prefetch" href="/assets/js/104.7101a956.js"><link rel="prefetch" href="/assets/js/105.833e6f80.js"><link rel="prefetch" href="/assets/js/106.978e1fc0.js"><link rel="prefetch" href="/assets/js/107.5af47fd0.js"><link rel="prefetch" href="/assets/js/108.efc3ce89.js"><link rel="prefetch" href="/assets/js/109.a69d6b5a.js"><link rel="prefetch" href="/assets/js/11.2de4afc9.js"><link rel="prefetch" href="/assets/js/110.30984b63.js"><link rel="prefetch" href="/assets/js/12.bfc099bd.js"><link rel="prefetch" href="/assets/js/13.20253e0d.js"><link rel="prefetch" href="/assets/js/14.67131b1c.js"><link rel="prefetch" href="/assets/js/15.1af26cbd.js"><link rel="prefetch" href="/assets/js/16.4b261ee0.js"><link rel="prefetch" href="/assets/js/17.1216332f.js"><link rel="prefetch" href="/assets/js/18.c0159773.js"><link rel="prefetch" href="/assets/js/19.0f007f87.js"><link rel="prefetch" href="/assets/js/2.b4633a05.js"><link rel="prefetch" href="/assets/js/20.4b295001.js"><link rel="prefetch" href="/assets/js/21.0c46767c.js"><link rel="prefetch" href="/assets/js/22.a5e065ea.js"><link rel="prefetch" href="/assets/js/23.f43a6a7e.js"><link rel="prefetch" href="/assets/js/24.245f4f15.js"><link rel="prefetch" href="/assets/js/25.618f74a1.js"><link rel="prefetch" href="/assets/js/26.274a606b.js"><link rel="prefetch" href="/assets/js/27.c2d8fe18.js"><link rel="prefetch" href="/assets/js/28.5c522d2a.js"><link rel="prefetch" href="/assets/js/29.c90fdb1a.js"><link rel="prefetch" href="/assets/js/3.9babd8f1.js"><link rel="prefetch" href="/assets/js/30.1ccbdebc.js"><link rel="prefetch" href="/assets/js/31.acf3eca6.js"><link rel="prefetch" href="/assets/js/32.ccfdc859.js"><link rel="prefetch" href="/assets/js/33.9b262756.js"><link rel="prefetch" href="/assets/js/34.c59a4044.js"><link rel="prefetch" href="/assets/js/35.2b10fefb.js"><link rel="prefetch" href="/assets/js/36.2daeeb7b.js"><link rel="prefetch" href="/assets/js/37.d649866c.js"><link rel="prefetch" href="/assets/js/38.aba1ac95.js"><link rel="prefetch" href="/assets/js/39.58a95fd1.js"><link rel="prefetch" href="/assets/js/40.8ef4d374.js"><link rel="prefetch" href="/assets/js/41.5799de7a.js"><link rel="prefetch" href="/assets/js/42.b7ee7489.js"><link rel="prefetch" href="/assets/js/43.28a65d64.js"><link rel="prefetch" href="/assets/js/44.90f92ea2.js"><link rel="prefetch" href="/assets/js/45.30b683fd.js"><link rel="prefetch" href="/assets/js/46.f57ccc19.js"><link rel="prefetch" href="/assets/js/47.7a82bd74.js"><link rel="prefetch" href="/assets/js/48.72503020.js"><link rel="prefetch" href="/assets/js/49.3a4ba077.js"><link rel="prefetch" href="/assets/js/50.0c3297f3.js"><link rel="prefetch" href="/assets/js/51.e9ba9363.js"><link rel="prefetch" href="/assets/js/52.473ee9ff.js"><link rel="prefetch" href="/assets/js/53.166d6e7a.js"><link rel="prefetch" href="/assets/js/54.78af3662.js"><link rel="prefetch" href="/assets/js/55.f0d54751.js"><link rel="prefetch" href="/assets/js/56.5de81531.js"><link rel="prefetch" href="/assets/js/57.6e18322f.js"><link rel="prefetch" href="/assets/js/58.1fccc879.js"><link rel="prefetch" href="/assets/js/59.773775e1.js"><link rel="prefetch" href="/assets/js/6.0c9cc532.js"><link rel="prefetch" href="/assets/js/60.0d665185.js"><link rel="prefetch" href="/assets/js/61.d9ae36dc.js"><link rel="prefetch" href="/assets/js/62.fb5e3b65.js"><link rel="prefetch" href="/assets/js/63.5ace8fda.js"><link rel="prefetch" href="/assets/js/64.d44fb0af.js"><link rel="prefetch" href="/assets/js/65.ed8fe56f.js"><link rel="prefetch" href="/assets/js/66.809078da.js"><link rel="prefetch" href="/assets/js/67.2489499e.js"><link rel="prefetch" href="/assets/js/68.e3ee952d.js"><link rel="prefetch" href="/assets/js/69.071411f8.js"><link rel="prefetch" href="/assets/js/7.8188415c.js"><link rel="prefetch" href="/assets/js/70.be8269cf.js"><link rel="prefetch" href="/assets/js/71.a320347a.js"><link rel="prefetch" href="/assets/js/72.f4fda48b.js"><link rel="prefetch" href="/assets/js/73.0f9f9284.js"><link rel="prefetch" href="/assets/js/74.b4028d07.js"><link rel="prefetch" href="/assets/js/75.6d63415f.js"><link rel="prefetch" href="/assets/js/77.62b794e1.js"><link rel="prefetch" href="/assets/js/78.63e767ab.js"><link rel="prefetch" href="/assets/js/79.45056905.js"><link rel="prefetch" href="/assets/js/8.20d7cb0f.js"><link rel="prefetch" href="/assets/js/80.e06c5521.js"><link rel="prefetch" href="/assets/js/81.bc82bd01.js"><link rel="prefetch" href="/assets/js/82.4aeb6081.js"><link rel="prefetch" href="/assets/js/83.3ed6146f.js"><link rel="prefetch" href="/assets/js/84.f2aff9f4.js"><link rel="prefetch" href="/assets/js/85.2b8f4e50.js"><link rel="prefetch" href="/assets/js/86.27aea1da.js"><link rel="prefetch" href="/assets/js/87.7f5dc71e.js"><link rel="prefetch" href="/assets/js/88.9ca6511c.js"><link rel="prefetch" href="/assets/js/89.e8f54ad1.js"><link rel="prefetch" href="/assets/js/9.ee6c43f7.js"><link rel="prefetch" href="/assets/js/90.9abac718.js"><link rel="prefetch" href="/assets/js/91.9d8f5f36.js"><link rel="prefetch" href="/assets/js/92.2277b907.js"><link rel="prefetch" href="/assets/js/93.efca2f57.js"><link rel="prefetch" href="/assets/js/94.e9cc0386.js"><link rel="prefetch" href="/assets/js/95.fa3326f7.js"><link rel="prefetch" href="/assets/js/96.82bafc57.js"><link rel="prefetch" href="/assets/js/97.da22d13e.js"><link rel="prefetch" href="/assets/js/98.d745e5ec.js"><link rel="prefetch" href="/assets/js/99.79a6f693.js">
    <link rel="stylesheet" href="/assets/css/0.styles.37bfab3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><div class="navbar"><div class="navbar-content"><div class="slogan">Valar Morghulis</div> <div class="links"><span class="link-item"><a href="/">首页</a></span> <span class="link-item"><a href="/category/iOS/">iOS</a></span> <span class="link-item"><a href="/category/other/">其他</a></span></div></div></div> <div class="content-header"><div class="post-title">iOS 图层几何学</div> <div class="post-info">2016-06-13 • iOS</div></div> <div class="content content__default"><h3 id="frame-v-s-bounds-v-s-center"><a href="#frame-v-s-bounds-v-s-center" class="header-anchor">#</a> frame v.s bounds v.s center</h3> <p>视图（<code>UIView</code>）有三种比较重要的布局属性：<code>frame</code>，<code>bounds</code>，<code>center</code>，图层（<code>CALayer</code>）对应叫做：<code>frame</code>，<code>bounds</code>，<code>position</code>。众所周知，视图是对图层的包装，名称虽然不完全相同，但都是指向相同的值，本文中<code>position</code>和<code>center</code>表示一个意思。</p> <p><code>bounds</code>和<code>position</code>是存储型属性，<code>bounds</code>标识了两个重要讯息：自身坐标系的起点（一般<code>(0, 0)</code>对应左上角）和图层的固有 size；而<code>position</code>标识了图层中心点相对于父图层坐标系的位置。</p> <p><code>frame</code>是计算型属性（虚拟属性），它的值根据<code>bounds</code>、<code>position</code>和<code>transform</code>计算而来。</p> <blockquote><p>Note: 这里的<code>transform</code>指的是图层（<code>CALayer</code>）的<code>transform</code>属性，而不是视图的<code>transform</code>属性。<code>UIView#transform</code>是<code>CATransform3D</code>类型，而<code>CALayer#transform</code>是<code>CGAffineTransform</code>类型，虽然类型不同，但根据我的理解，视图的<code>transform</code>和其图层的<code>transform</code>直接相关，换句话说，<code>UIView#transform</code>是<code>CALayer#transform</code>的简化版。</p></blockquote> <p>当<code>CALayer#transform</code>的值等于<code>CATransform3DIdentity</code>，或者当<code>UIView#transform</code>的值等于<code>CGAffineTransformIdentity</code>时，<code>frame</code>、<code>position</code>和<code>bounds</code>存在着如下关系：</p> <ul><li>frame.origin = position - (bounds.size / 2.0)</li> <li>frame.size = bounds.size</li></ul> <p>在这种情况下：</p> <ul><li><code>position</code>和<code>bounds</code>彼此独立，改变任意一个值不会影响另外一个；</li> <li><code>frame.size</code>和<code>bounds.size</code>直接相关，修改任何一个会影响另外一个；</li> <li><code>frame.origin</code>和<code>position</code>直接相关，修改任何一个会影响另外一个；</li> <li><code>bounds.origin</code>不会对<code>frame</code>和<code>center</code>产生影响，但会影响到子图层的位置；</li></ul> <p>当视图发生仿射变换时，比如平移、旋转、缩放，经验证发现：<code>position</code>和<code>bounds</code>都不会改变，而<code>frame</code>会改变。并且当对图层进行缩放时，<code>frame.size</code>会和<code>bounds.size</code>不一致，详细说明参考<a href="https://zsisme.gitbooks.io/ios-/content/chapter3/layout.html" target="_blank" rel="noopener noreferrer">《iOS 核心动画高级技巧》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <blockquote><p>P.S: 还没测试图层 3D 变换时<code>bounds</code>和<code>position</code>的变化情况，但我估计结果是一样的。</p></blockquote> <p>我认为：把视图和图层的<code>frame</code>属性拿掉，iOS 布局系统也能照样运转，<code>frame</code>的作用不过是为了迎合大部分人的布局惯性思维罢了。</p> <h3 id="anchorpoint"><a href="#anchorpoint" class="header-anchor">#</a> anchorPoint</h3> <p>按理说，图层的<code>position</code>和<code>bounds.size</code>就足以告诉布局系统它在父图层中所占据的位置和面积了，前者指示了其<strong>中心点</strong>的坐标，后者指示了其大小。</p> <p>但问题出在<strong>中心点</strong>上，图层的<code>position</code>之所以叫<code>position</code>而不叫<code>center</code>是有原因的。</p> <p>可以想象图层和很多其他现实物体一样，有一个<em>把柄</em>，布局系统在摆放图层时，直接“拖”着这个<em>把柄</em>，把它杵到<code>position</code>对应的坐标上即可。在大多数时候，这个<em>把柄</em>所在的位置就是图层的中心点。然而，iOS 允许自定义图层的<em>把柄</em>位置，修改<code>CALayer#anchorPoint</code>值即可，<code>anchorPoint</code>是<code>CGPoint</code>类型，其默认值为<code>(0.5, 0.5)</code>（归一化值），当修改其值为<code>(0, 0)</code>，这意味着图层的<em>把柄</em>被移到左上角。换句话说，图层的<code>anchorPoint</code>属性值会影响到它的摆放位置，但该值和<code>position</code>、<code>bounds</code>彼此独立，没有任何关系，和<code>frame</code>更是谈不上啥关系了。</p> <p>在什么时候需要修改<code>anchorPoint</code>属性值呢？<a href="https://zsisme.gitbooks.io/ios-/content/chapter3/anchor.html" target="_blank" rel="noopener noreferrer">《ios 核心动画高级技巧》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>有一个非常不错的应用实例。</p> <p><code>anchorPoint</code>所对应的位置，常常被称为图层的<strong>锚点</strong>。</p> <p>更值得一提的是，视图的仿射变换和图层的 3D 变换，都是围绕图层的锚点进行的。</p> <p>具体来说，当<code>anchorPoint</code>的值为默认值时，对视图进行缩放或旋转，其中心点都不会发生迁移，如下：</p> <div class="custom-image-wrapper" data-v-339c7bd5><img src="/image/default-anchor-point.gif" alt="Default Anchor Point" srcset="/image/default-anchor-point.gif 2x" data-v-339c7bd5></div> <p>当修改两个 view 的<code>anchorPoint</code>属性值为<code>(0.0, 0.0)</code>后，结果如下：</p> <div class="custom-image-wrapper" data-v-339c7bd5><img src="/image/new-anchor-point.gif" alt="New Anchor Point" srcset="/image/new-anchor-point.gif 2x" data-v-339c7bd5></div> <p>显然，此时视图的缩放和旋转都以左上角为基准点。</p> <h3 id="z-坐标轴"><a href="#z-坐标轴" class="header-anchor">#</a> Z 坐标轴</h3> <p><code>UIView</code>使用的是严格的二维坐标系，而<code>CALayer</code>存在于一个三维空间中。</p> <h3 id="本文参考"><a href="#本文参考" class="header-anchor">#</a> 本文参考</h3> <ul><li><a href="http://stackoverflow.com/questions/5361369/uiview-frame-bounds-and-center" target="_blank" rel="noopener noreferrer">UIView frame, bounds and center<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zsisme.gitbooks.io/ios-/content/" target="_blank" rel="noopener noreferrer">iOS 核心动画高级技巧<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.50bca889.js" defer></script><script src="/assets/js/5.081d1701.js" defer></script><script src="/assets/js/76.d5b4df24.js" defer></script><script src="/assets/js/4.a7413ce2.js" defer></script>
  </body>
</html>
