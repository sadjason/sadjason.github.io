<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用 UIScrollView | 张不坏的博客</title>
    <meta name="description" content="Just For Fun">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.37bfab3d.css" as="style"><link rel="preload" href="/assets/js/app.50bca889.js" as="script"><link rel="preload" href="/assets/js/5.081d1701.js" as="script"><link rel="preload" href="/assets/js/92.2277b907.js" as="script"><link rel="prefetch" href="/assets/js/10.7bb33f06.js"><link rel="prefetch" href="/assets/js/100.014ff06c.js"><link rel="prefetch" href="/assets/js/101.28f11de0.js"><link rel="prefetch" href="/assets/js/102.be9d2e87.js"><link rel="prefetch" href="/assets/js/103.a1210d81.js"><link rel="prefetch" href="/assets/js/104.7101a956.js"><link rel="prefetch" href="/assets/js/105.833e6f80.js"><link rel="prefetch" href="/assets/js/106.978e1fc0.js"><link rel="prefetch" href="/assets/js/107.5af47fd0.js"><link rel="prefetch" href="/assets/js/108.efc3ce89.js"><link rel="prefetch" href="/assets/js/109.a69d6b5a.js"><link rel="prefetch" href="/assets/js/11.2de4afc9.js"><link rel="prefetch" href="/assets/js/110.30984b63.js"><link rel="prefetch" href="/assets/js/12.bfc099bd.js"><link rel="prefetch" href="/assets/js/13.20253e0d.js"><link rel="prefetch" href="/assets/js/14.67131b1c.js"><link rel="prefetch" href="/assets/js/15.1af26cbd.js"><link rel="prefetch" href="/assets/js/16.4b261ee0.js"><link rel="prefetch" href="/assets/js/17.1216332f.js"><link rel="prefetch" href="/assets/js/18.c0159773.js"><link rel="prefetch" href="/assets/js/19.0f007f87.js"><link rel="prefetch" href="/assets/js/2.b4633a05.js"><link rel="prefetch" href="/assets/js/20.4b295001.js"><link rel="prefetch" href="/assets/js/21.0c46767c.js"><link rel="prefetch" href="/assets/js/22.a5e065ea.js"><link rel="prefetch" href="/assets/js/23.f43a6a7e.js"><link rel="prefetch" href="/assets/js/24.245f4f15.js"><link rel="prefetch" href="/assets/js/25.618f74a1.js"><link rel="prefetch" href="/assets/js/26.274a606b.js"><link rel="prefetch" href="/assets/js/27.c2d8fe18.js"><link rel="prefetch" href="/assets/js/28.5c522d2a.js"><link rel="prefetch" href="/assets/js/29.c90fdb1a.js"><link rel="prefetch" href="/assets/js/3.9babd8f1.js"><link rel="prefetch" href="/assets/js/30.1ccbdebc.js"><link rel="prefetch" href="/assets/js/31.acf3eca6.js"><link rel="prefetch" href="/assets/js/32.ccfdc859.js"><link rel="prefetch" href="/assets/js/33.9b262756.js"><link rel="prefetch" href="/assets/js/34.c59a4044.js"><link rel="prefetch" href="/assets/js/35.2b10fefb.js"><link rel="prefetch" href="/assets/js/36.2daeeb7b.js"><link rel="prefetch" href="/assets/js/37.d649866c.js"><link rel="prefetch" href="/assets/js/38.aba1ac95.js"><link rel="prefetch" href="/assets/js/39.58a95fd1.js"><link rel="prefetch" href="/assets/js/4.a7413ce2.js"><link rel="prefetch" href="/assets/js/40.8ef4d374.js"><link rel="prefetch" href="/assets/js/41.5799de7a.js"><link rel="prefetch" href="/assets/js/42.b7ee7489.js"><link rel="prefetch" href="/assets/js/43.28a65d64.js"><link rel="prefetch" href="/assets/js/44.90f92ea2.js"><link rel="prefetch" href="/assets/js/45.30b683fd.js"><link rel="prefetch" href="/assets/js/46.f57ccc19.js"><link rel="prefetch" href="/assets/js/47.7a82bd74.js"><link rel="prefetch" href="/assets/js/48.72503020.js"><link rel="prefetch" href="/assets/js/49.3a4ba077.js"><link rel="prefetch" href="/assets/js/50.0c3297f3.js"><link rel="prefetch" href="/assets/js/51.e9ba9363.js"><link rel="prefetch" href="/assets/js/52.473ee9ff.js"><link rel="prefetch" href="/assets/js/53.166d6e7a.js"><link rel="prefetch" href="/assets/js/54.78af3662.js"><link rel="prefetch" href="/assets/js/55.f0d54751.js"><link rel="prefetch" href="/assets/js/56.5de81531.js"><link rel="prefetch" href="/assets/js/57.6e18322f.js"><link rel="prefetch" href="/assets/js/58.1fccc879.js"><link rel="prefetch" href="/assets/js/59.773775e1.js"><link rel="prefetch" href="/assets/js/6.0c9cc532.js"><link rel="prefetch" href="/assets/js/60.0d665185.js"><link rel="prefetch" href="/assets/js/61.d9ae36dc.js"><link rel="prefetch" href="/assets/js/62.fb5e3b65.js"><link rel="prefetch" href="/assets/js/63.5ace8fda.js"><link rel="prefetch" href="/assets/js/64.d44fb0af.js"><link rel="prefetch" href="/assets/js/65.ed8fe56f.js"><link rel="prefetch" href="/assets/js/66.809078da.js"><link rel="prefetch" href="/assets/js/67.2489499e.js"><link rel="prefetch" href="/assets/js/68.e3ee952d.js"><link rel="prefetch" href="/assets/js/69.071411f8.js"><link rel="prefetch" href="/assets/js/7.8188415c.js"><link rel="prefetch" href="/assets/js/70.be8269cf.js"><link rel="prefetch" href="/assets/js/71.a320347a.js"><link rel="prefetch" href="/assets/js/72.f4fda48b.js"><link rel="prefetch" href="/assets/js/73.0f9f9284.js"><link rel="prefetch" href="/assets/js/74.b4028d07.js"><link rel="prefetch" href="/assets/js/75.6d63415f.js"><link rel="prefetch" href="/assets/js/76.d5b4df24.js"><link rel="prefetch" href="/assets/js/77.62b794e1.js"><link rel="prefetch" href="/assets/js/78.63e767ab.js"><link rel="prefetch" href="/assets/js/79.45056905.js"><link rel="prefetch" href="/assets/js/8.20d7cb0f.js"><link rel="prefetch" href="/assets/js/80.e06c5521.js"><link rel="prefetch" href="/assets/js/81.bc82bd01.js"><link rel="prefetch" href="/assets/js/82.4aeb6081.js"><link rel="prefetch" href="/assets/js/83.3ed6146f.js"><link rel="prefetch" href="/assets/js/84.f2aff9f4.js"><link rel="prefetch" href="/assets/js/85.2b8f4e50.js"><link rel="prefetch" href="/assets/js/86.27aea1da.js"><link rel="prefetch" href="/assets/js/87.7f5dc71e.js"><link rel="prefetch" href="/assets/js/88.9ca6511c.js"><link rel="prefetch" href="/assets/js/89.e8f54ad1.js"><link rel="prefetch" href="/assets/js/9.ee6c43f7.js"><link rel="prefetch" href="/assets/js/90.9abac718.js"><link rel="prefetch" href="/assets/js/91.9d8f5f36.js"><link rel="prefetch" href="/assets/js/93.efca2f57.js"><link rel="prefetch" href="/assets/js/94.e9cc0386.js"><link rel="prefetch" href="/assets/js/95.fa3326f7.js"><link rel="prefetch" href="/assets/js/96.82bafc57.js"><link rel="prefetch" href="/assets/js/97.da22d13e.js"><link rel="prefetch" href="/assets/js/98.d745e5ec.js"><link rel="prefetch" href="/assets/js/99.79a6f693.js">
    <link rel="stylesheet" href="/assets/css/0.styles.37bfab3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><div class="navbar"><div class="navbar-content"><div class="slogan">Valar Morghulis</div> <div class="links"><span class="link-item"><a href="/">首页</a></span> <span class="link-item"><a href="/category/iOS/">iOS</a></span> <span class="link-item"><a href="/category/other/">其他</a></span></div></div></div> <div class="content-header"><div class="post-title">使用 UIScrollView</div> <div class="post-info">2016-05-21 • iOS</div></div> <div class="content content__default"><p><code>UIScrollview</code>是 iOS 世界里一个比较麻烦的控件，本文旨在梳理相关 API 的使用姿势，以便在使用的时候进行参考。</p> <h2 id="uiscrollviewdelegate"><a href="#uiscrollviewdelegate" class="header-anchor">#</a> UIScrollViewDelegate</h2> <p>简单介绍一下 UIScrollViewDelegate 定义的一些方法，这里只涉及与 scroll 相关的方法，zoom 相关的方法略过不表。</p> <ul><li><code>scrollViewDidScroll(_:)</code></li></ul> <p>这个方法在任何方式触发<code>contentOffset</code>变化的时候都会被调用（包括用户拖动，减速过程，直接通过代码设置等），可以用于监控<code>contentOffset</code>的变化，并根据当前的<code>contentOffset</code>对其他 view 做出随动调整。</p> <ul><li><code>scrollViewWillBeginDragging(_:)</code></li></ul> <p>用户开始拖动 scroll view 的时候被调用。</p> <ul><li><code>scrollViewWillEndDragging(_:withVelocity:targetContentOffset:)</code></li></ul> <p>这个方法是 iOS 5 之后引入的，可在它的基础上实现更为丰富的自定义 paging。</p> <ul><li><code>scrollViewDidEndDragging(_:willDecelerate:)</code></li></ul> <p>在用户结束拖动后被调用，<code>willDecelerate</code>为 YES 时，结束拖动后会有减速过程（惯性）。</p> <ul><li><code>scrollViewWillBeginDecelerating(_:)</code></li></ul> <p>减速动画开始前被调用。</p> <ul><li><code>scrollViewDidEndDecelerating(_:)</code></li></ul> <p>减速动画结束时被调用，这里有一种特殊情况：当一次减速动画尚未结束的时候再次 drag scroll view，该方法不会被调用，并且这时 scroll view 的<code>dragging</code>和<code>decelerating</code>属性都是<code>YES</code>。新的 dragging 如果有加速度，那么<code>scrollViewWillBeginDecelerating(_:)</code>会再一次被调用，然后才是<code>scrollViewDidEndDecelerating(_:)</code>；如果没有加速度，虽然<code>scrollViewWillBeginDecelerating(_:)</code>不会被调用，但前一次留下的<code>scrollViewDidEndDecelerating(_:)</code>会被调用。</p> <blockquote><p>P.S: 以上的解释比较拗口，动手体验一下就明白了。</p></blockquote> <ul><li><code>scrollViewDidEndScrollingAnimation(_:)</code></li></ul> <p>当通过代码滑动 scroll view 时（<code>setContentOffset(_:animated:)</code>或者<code>scrollRectVisible(_:animated:)</code>），动画结束时会调用该方法；值得一提的是，当且仅当动画存在时才会调用该方法。</p> <h2 id="scrolling-with-finger"><a href="#scrolling-with-finger" class="header-anchor">#</a> Scrolling With Finger</h2> <p>我总结了一些手指控制 UIScrollView 滑动的场景，将相关的回调给列出来了。</p> <p><strong>场景一：一次正常的滑动-减速-停止</strong></p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token comment">// 手指介入</span>
<span class="token function">scrollViewWillBeginDragging</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>
<span class="token comment">// 开始滑动</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>                     <span class="token comment">// scrolling...</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>                     <span class="token comment">// scrolling...</span>
<span class="token comment">// ...</span>

<span class="token comment">// 手指离开屏幕（scrolling继续，并未停滞）</span>
<span class="token function">scrollViewWillEndDragging</span><span class="token punctuation">(</span>scrollView<span class="token punctuation">:</span>withVelocity<span class="token punctuation">:</span>targetContentOffset<span class="token punctuation">:</span><span class="token punctuation">)</span>
<span class="token function">scrollViewDidEndDragging</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span>willDecelerate<span class="token punctuation">:</span><span class="token punctuation">)</span> <span class="token comment">// 拖拽结束（willDecelerate=true）</span>
<span class="token function">scrollViewWillBeginDecelerating</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>         <span class="token comment">// 减速</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>                     <span class="token comment">// scrolling...</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>                     <span class="token comment">// scrolling...</span>
<span class="token comment">// ...</span>

<span class="token function">scrollViewDidEndDecelerating</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>            <span class="token comment">// 减速结束</span>
</code></pre></div><p><strong>场景二：减速过程中的手指介入（点停）</strong></p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token comment">// 手指介入</span>
<span class="token function">scrollViewWillBeginDragging</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>
<span class="token comment">// 开始滑动</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>             <span class="token comment">// scrolling...</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>             <span class="token comment">// scrolling...</span>
<span class="token comment">// ...</span>

<span class="token comment">// 手指离开屏幕（scrolling继续，并未停滞）</span>
<span class="token function">scrollViewWillEndDragging</span><span class="token punctuation">(</span>scrollView<span class="token punctuation">:</span>withVelocity<span class="token punctuation">:</span>targetContentOffset<span class="token punctuation">:</span><span class="token punctuation">)</span>
<span class="token function">scrollViewDidEndDragging</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span>willDecelerate<span class="token punctuation">:</span><span class="token punctuation">)</span> <span class="token comment">// 拖拽结束（willDecelerate=true）</span>
<span class="token function">scrollViewWillBeginDecelerating</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>         <span class="token comment">// 减速</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>             <span class="token comment">// scrolling...</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>             <span class="token comment">// scrolling...</span>
<span class="token comment">// ...</span>

<span class="token comment">// 手指介入（scrolling停止 -- 之前的操作被取消）</span>
<span class="token function">scrollViewWillBeginDragging</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>
<span class="token comment">// 手指离开屏幕</span>
<span class="token function">scrollViewWillEndDragging</span><span class="token punctuation">(</span>scrollView<span class="token punctuation">:</span>withVelocity<span class="token punctuation">:</span>targetContentOffset<span class="token punctuation">:</span><span class="token punctuation">)</span>
<span class="token function">scrollViewDidEndDragging</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span>willDecelerate<span class="token punctuation">:</span><span class="token punctuation">)</span>     <span class="token comment">// 拖拽结束（willDecelerate=false）</span>
<span class="token function">scrollViewDidEndDecelerating</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>                <span class="token comment">// 减速结束</span>
</code></pre></div><p><strong>场景三：减速过程中的手指介入（乱滑）</strong></p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token comment">// 手指介入</span>
<span class="token function">scrollViewWillBeginDragging</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>
<span class="token comment">// 开始滑动</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>             <span class="token comment">// scrolling...</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>             <span class="token comment">// scrolling...</span>
<span class="token comment">// ...</span>

<span class="token comment">// 手指离开屏幕（scrolling继续，并未停滞）</span>
<span class="token function">scrollViewWillEndDragging</span><span class="token punctuation">(</span>scrollView<span class="token punctuation">:</span>withVelocity<span class="token punctuation">:</span>targetContentOffset<span class="token punctuation">:</span><span class="token punctuation">)</span>
<span class="token function">scrollViewDidEndDragging</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span>willDecelerate<span class="token punctuation">:</span><span class="token punctuation">)</span> <span class="token comment">// 拖拽结束（willDecelerate=true）</span>
<span class="token function">scrollViewWillBeginDecelerating</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>         <span class="token comment">// 减速</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>             <span class="token comment">// scrolling...</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>             <span class="token comment">// scrolling...</span>
<span class="token comment">// ...</span>

<span class="token comment">// 手指介入--重新拖拽（scrolling停止 -- 之前的操作被取消）</span>
<span class="token function">scrollViewWillBeginDragging</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>
<span class="token comment">// 开始滑动</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>             <span class="token comment">// scrolling...</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>             <span class="token comment">// scrolling...</span>
<span class="token comment">// ...</span>

<span class="token comment">// 手指离开屏幕（scrolling继续，并未停滞）</span>
<span class="token function">scrollViewWillEndDragging</span><span class="token punctuation">(</span>scrollView<span class="token punctuation">:</span>withVelocity<span class="token punctuation">:</span>targetContentOffset<span class="token punctuation">:</span><span class="token punctuation">)</span>
<span class="token function">scrollViewDidEndDragging</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span>willDecelerate<span class="token punctuation">:</span><span class="token punctuation">)</span> <span class="token comment">// 拖拽结束（willDecelerate=true）</span>
<span class="token function">scrollViewWillBeginDecelerating</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>         <span class="token comment">// 减速</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>             <span class="token comment">// scrolling...</span>
<span class="token function">scrollViewDidScroll</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>             <span class="token comment">// scrolling...</span>
<span class="token comment">// ...</span>

<span class="token comment">// 手指介入--点停（scrolling停止 -- 之前的操作被取消）</span>
<span class="token function">scrollViewWillBeginDragging</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>

<span class="token comment">// 手指离开屏幕</span>
<span class="token function">scrollViewWillEndDragging</span><span class="token punctuation">(</span>scrollView<span class="token punctuation">:</span>withVelocity<span class="token punctuation">:</span>targetContentOffset<span class="token punctuation">:</span><span class="token punctuation">)</span>
<span class="token function">scrollViewDidEndDragging</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span>willDecelerate<span class="token punctuation">:</span><span class="token punctuation">)</span>     <span class="token comment">// 拖拽结束（willDecelerate=false）</span>
<span class="token function">scrollViewDidEndDecelerating</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span>                <span class="token comment">// 减速结束</span>
</code></pre></div><h2 id="scrolling-programmatically"><a href="#scrolling-programmatically" class="header-anchor">#</a> Scrolling Programmatically</h2> <p><strong>Scrolling to a Specific Offset</strong></p> <p>可通过设置 content offset 让 scrollView 滚动到某个指定位置，有两种方式：一是直接给<code>contentOffset</code>属性赋值，二是调用<code>setContentOffset(_:animated:)</code>方法。对于第二种，当<code>animated</code>参数设置为 NO，等效于第一种方式。</p> <p>无论是哪一种情况，<code>delegate</code>都会接收到<code>scrollViewDidScroll(_:)</code>消息。</p> <p>只是当禁止动画时，<code>delegate</code>只会收到一次<code>scrollViewDidScroll(_:)</code>消息；当允许动画时，<code>delegate</code>会在动画过程中接收到一系列<code>scrollViewDidScroll(_:)</code>消息，并且当动画结束时，<code>delegate</code>还会接收到<code>scrollViewDidEndScrollingAnimation(_:)</code>消息。</p> <p><strong>Making a rectangle visible</strong></p> <p>还可以调用<code>scrollRectToVisible(_:animated:)</code>方法让 scrollView 滚动到一个合适的位置以使指定区域可见，<code>animated</code>参数依然是用来控制动画开关的。当关闭动画时，<code>delegate</code>会接收到一次<code>scrollViewDidScroll(_:)</code>消息；当允许动画时，<code>delegate</code>会在动画过程中接收到一系列<code>scrollViewDidScroll(_:)</code>消息，并且当动画结束时，<code>delegate</code>还会接收到<code>scrollViewDidEndScrollingAnimation(_:)</code>消息。</p> <p><strong>Scroll To Top</strong></p> <p><code>UITableView</code>等子类还实现了 Scroll To Top 功能，这里不赘述了，详细参考<a href="https://developer.apple.com/library/ios/documentation/WindowsViews/Conceptual/UIScrollView_pg/ScrollingViewContent/ScrollingViewContent.html" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="tracking-the-start-and-completion-of-a-scroll-action"><a href="#tracking-the-start-and-completion-of-a-scroll-action" class="header-anchor">#</a> Tracking The Start and Completion Of A Scroll Action</h2> <p>Implement the scrollViewWillBeginDragging: method to receive notification that dragging will begin.</p> <p>当编程实现滚动（设置<code>contentOffset</code>、）时，<code>scrollViewWillBeginDragging:</code>也会被调用吗？</p> <p>To determine when scrolling is complete you must implement two delegate methods: scrollViewDidEndDragging:willDecelerate: and scrollViewDidEndDecelerating:. Scrolling is completed either when the delegate receives the scrollViewDidEndDragging:willDecelerate: message with NO as the decelerate parameter, or when your delegate receives the scrollViewDidEndDecelerating: method. In either case, scrolling is complete.</p> <p><strong>编程实现滚动时抗干扰</strong></p> <p>在开始和结束时设置<code>userInteractionEnabled</code>属性即可：</p> <div class="language-swift extra-class"><pre class="language-swift"><code>scrollView<span class="token punctuation">.</span>userInteractionEnabled <span class="token operator">=</span> <span class="token boolean">false</span>
scrollView<span class="token punctuation">.</span><span class="token function">setContentOffset</span><span class="token punctuation">(</span><span class="token builtin">CGPointZero</span><span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">scrollViewDidEndScrollingAnimation</span><span class="token punctuation">(</span>scrollView<span class="token punctuation">:</span> <span class="token builtin">UIScrollView</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  scrollView<span class="token punctuation">.</span>userInteractionEnabled <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="经验之谈"><a href="#经验之谈" class="header-anchor">#</a> 经验之谈</h2> <p><strong>不可描述的问题</strong></p> <p>一般来说，在 UIScrollView 静止状态下，点击（只是轻点一下）不会触发 UIScrollViewDelegate 相关的回调，但曾在开发中遇到了一件诡异的事情，点击静止状态下的 UIScrollView 会触发<code>scrollViewWillBeginDecelerating(_:)</code>和<code>scrollViewDidEndDecelerating(_:)</code>回调，代码如下：</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>viewDidLoad <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLoad<span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor whiteColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  UIScrollView <span class="token operator">*</span>scrollView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UIScrollView alloc<span class="token punctuation">]</span> initWithFrame<span class="token punctuation">:</span><span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  scrollView<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor lightGrayColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
  scrollView<span class="token punctuation">.</span>bounces <span class="token operator">=</span> NO<span class="token punctuation">;</span>
  scrollView<span class="token punctuation">.</span>contentSize <span class="token operator">=</span> <span class="token function">CGSizeMake</span><span class="token punctuation">(</span><span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  scrollView<span class="token punctuation">.</span>pagingEnabled <span class="token operator">=</span> YES<span class="token punctuation">;</span>
  scrollView<span class="token punctuation">.</span>showsHorizontalScrollIndicator <span class="token operator">=</span> NO<span class="token punctuation">;</span>
  scrollView<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
  
  <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>view addSubview<span class="token punctuation">:</span>scrollView<span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  UIView <span class="token operator">*</span>view1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UIView alloc<span class="token punctuation">]</span> initWithFrame<span class="token punctuation">:</span><span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  view1<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor redColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">[</span>scrollView addSubview<span class="token punctuation">:</span>view1<span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  UIView <span class="token operator">*</span>view2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UIView alloc<span class="token punctuation">]</span> initWithFrame<span class="token punctuation">:</span><span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  view2<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor greenColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">[</span>scrollView addSubview<span class="token punctuation">:</span>view2<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>排查了好久，最终发现问题出在<code>scrollView.pagingEnabled = YES</code>这里，以上的 scroll view 允许 paging，然而，其<code>contentSize.width</code>并不是<code>size.width</code>的整数倍，这会让它显式最后一页时没办法达到稳定状态，该情况下点击 UIScrollView 会触发<code>scrollViewWillBeginDecelerating(_:)</code>和<code>scrollViewDidEndDecelerating(_:)</code>。该情景不太容易描述...</p> <p><strong>UIScrollView Custom Paging</strong></p> <p>通过回调<code>scrollViewWillEndDragging(_:withVelocity:targetContentOffset:)</code>可以在<code>UIScrollView#pagingEnabled</code>设为<code>false</code>的情况下自己实现 paging 效果。然而，用户体验并不好，至少不如<code>UIScrollView#pagingEnabled = true</code>顺畅，参考<a href="http://stackoverflow.com/questions/6945964/uiscrollview-custom-paging" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，不晓得有没什么办法改善操作体验。</p> <h2 id="本文参考"><a href="#本文参考" class="header-anchor">#</a> 本文参考</h2> <ul><li><a href="https://developer.apple.com/library/ios/documentation/WindowsViews/Conceptual/UIScrollView_pg/ScrollingViewContent/ScrollingViewContent.html" target="_blank" rel="noopener noreferrer">Scroll View Programming Guide for iOS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://tech.glowing.com/cn/practice-in-uiscrollview/" target="_blank" rel="noopener noreferrer">UIScrollView 实践经验<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.50bca889.js" defer></script><script src="/assets/js/5.081d1701.js" defer></script><script src="/assets/js/92.2277b907.js" defer></script>
  </body>
</html>
