(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{136:function(t,e,a){"use strict";a.r(e);var n=a(0),o=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[a("strong",[t._v("隐式动画")]),t._v("是在 iOS 平台创建动态用户界面的一种直接方式，也是"),a("code",[t._v("UIKit")]),t._v("动画机制的基础，不过它并不能涵盖所有的动画类型。本文旨在要研究"),a("strong",[t._v("显式动画")]),t._v("，它能够对一些属性做指定的自定义动画，或者创建非线性动画，比如沿着任意一条曲线移动。")]),t._v(" "),a("h2",{attrs:{id:"caanimation-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#caanimation-简介"}},[t._v("#")]),t._v(" CAAnimation 简介")]),t._v(" "),a("p",[t._v("研究显式动画的关键是分析"),a("code",[t._v("CAAnimation")]),t._v("及其子类，"),a("code",[t._v("CAAnimation")]),t._v("和其子类的继承体系如下：")]),t._v(" "),a("div",{staticClass:"language-textile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-textile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token phrase"}},[a("span",{pre:!0,attrs:{class:"token table"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("--CAAnimation: CAMediaTiming\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("--CAPropertyAnimation\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("--CABasicAnimation\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("--CAKeyframeAnimation\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("--CATransition\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")])]),t._v("--CAAnimationGroup\n")])])])]),a("p",[t._v("一般情况下不直接使用"),a("code",[t._v("CAAnimation")]),t._v("，而使用其子类；并且"),a("code",[t._v("CAPropertyAnimation")]),t._v("也不能直接使用。")]),t._v(" "),a("p",[a("code",[t._v("CAAnimation")]),t._v("遵循"),a("code",[t._v("CAMediaTiming")]),t._v("协议，常用属性包括：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("beginTime")]),t._v(" -- 控制动画开始时间，譬如"),a("code",[t._v("CACurrentMediaTime()+1.0")]),t._v("对应的是 1 秒的 delay；")]),t._v(" "),a("li",[a("code",[t._v("duration")]),t._v(" -- 控制动画的持续时间；")]),t._v(" "),a("li",[a("code",[t._v("repeatCount")]),t._v(" -- 动画的重复次数，永久重复对应"),a("code",[t._v("HUGE_VALF")]),t._v("，"),a("code",[t._v("1")]),t._v("表不重复；")]),t._v(" "),a("li",[a("code",[t._v("timingFunction")]),t._v(" -- 控制动画运行的节奏，一般使用"),a("code",[t._v("CAMediaTimingFunction(name:)")]),t._v("赋值，"),a("code",[t._v("name")]),t._v("可设置为：\n"),a("ul",[a("li",[a("code",[t._v("kCAMediaTimingFunctionLinear")])]),t._v(" "),a("li",[a("code",[t._v("kCAMediaTimingFunctionEaseIn")])]),t._v(" "),a("li",[a("code",[t._v("kCAMediaTimingFunctionEaseOut")])]),t._v(" "),a("li",[a("code",[t._v("kCAMediaTimingFunctionEaseInEaseOut")])]),t._v(" "),a("li",[a("code",[t._v("kCAMediaTimingFunctionDefault")])])])]),t._v(" "),a("li",[a("code",[t._v("delegate")]),t._v(" -- 动画代理，用来监听动画的执行过程，两个方法：\n"),a("ul",[a("li",[a("code",[t._v("func animationDidStart(animation: CAAnimation)")])]),t._v(" "),a("li",[a("code",[t._v("func animationDidStop(animation: CAAnimation, finished flag: Bool)")])])])]),t._v(" "),a("li",[a("code",[t._v("removedOnCompletion")]),t._v(" -- 当设置为"),a("code",[t._v("true")]),t._v("时，动画完成后，layer 又会回到原处；当设置为"),a("code",[t._v("false")]),t._v("，且"),a("code",[t._v("fillMode")]),t._v("设置为"),a("code",[t._v("kCAFillModeForwards")]),t._v("时，layer 动画完成后不动；")]),t._v(" "),a("li",[a("code",[t._v("fillMode")]),t._v(" -- determine how the timed object behaves once its active duration has completed.")])]),t._v(" "),a("p",[t._v("额外阐述一下"),a("code",[t._v("fillMode")]),t._v("属性。在此之前先引入几个概念，经历一个完整动画的 layer 的时间线可分为 3 个部分：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("动画前")]),t._v(" -- 添加动画到动画开始前的时间段；")]),t._v(" "),a("li",[a("strong",[t._v("动画中")]),t._v(" -- 动画开始到结束的时间段；")]),t._v(" "),a("li",[a("strong",[t._v("动画后")]),t._v(" -- 动画结束后的时间；")])]),t._v(" "),a("p",[t._v("动画的实质是 layer 的属性值从某个值到另一个值的变化过程，站在属性值的角度同样有 3 个概念：")]),t._v(" "),a("ul",[a("li",[t._v("origin value -- 添加动画前的属性值")]),t._v(" "),a("li",[t._v("from value -- 动画的初始值")]),t._v(" "),a("li",[t._v("to value -- 动画的结束值")])]),t._v(" "),a("p",[a("code",[t._v("fillMode")]),t._v("的属性值会影响 layer 在"),a("strong",[t._v("动画前")]),t._v("和"),a("strong",[t._v("动画后")]),t._v("的行为，有 4 种可设置的属性值：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("kCAFillModeRemoved")]),t._v(" -- 此为默认值，layer 在"),a("strong",[t._v("动画前")]),t._v("的属性值一直未 origin value，动画开始时属性值立马切换到 from value，然后动画变化到 to value，动画结束时属性值又立马切换到 origin value；")]),t._v(" "),a("li",[a("code",[t._v("kCAFillModeForwards")]),t._v(" -- 相对于"),a("code",[t._v("kCAFillModeRemoved")]),t._v("，layer 在动画结束时仍然保持属性值为 to value；")]),t._v(" "),a("li",[a("code",[t._v("kCAFillModeBackwards")]),t._v(" -- 相对于"),a("code",[t._v("kCAFillModeRemoved")]),t._v("，layer 在动画前就将属性值切换到 origin value；")]),t._v(" "),a("li",[a("code",[t._v("kCAFillModeBoth")]),t._v(" -- "),a("code",[t._v("kCAFillModeForwards")]),t._v("和"),a("code",[t._v("kCAFillModeBackwards")]),t._v("的合体；")])]),t._v(" "),a("blockquote",[a("p",[t._v("Note: "),a("code",[t._v("kCAFillModeForwards")]),t._v("起作用的前提是"),a("code",[t._v("removedOnCompletion")]),t._v("的属性值被设置为"),a("code",[t._v("false")]),t._v("，"),a("code",[t._v("kCAFillModeBackwards")]),t._v("的作用在 delay 不为 0 时才能直观感受到，更多内容参考"),a("a",{attrs:{href:"https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAMediaTiming_protocol/index.html#//apple_ref/doc/constant_group/Fill_Modes",target:"_blank",rel:"noopener noreferrer"}},[t._v("CAMediaTiming -- Fill Modes"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("p",[a("strong",[t._v("使用 CAAnimation 的基本套路")])]),t._v(" "),a("p",[t._v("使用"),a("code",[t._v("CAAnimation")]),t._v("（或者其子类）的基本套路是：")]),t._v(" "),a("ol",[a("li",[t._v("初始化一个"),a("code",[t._v("CAAnimation")]),t._v("对象，并设置一些动画相关属性；")]),t._v(" "),a("li",[t._v("调用"),a("code",[t._v("CALayer#addAnimation(_:forKey:)")]),t._v("方法添加"),a("code",[t._v("CAAnimation")]),t._v("对象到"),a("code",[t._v("CALayer")]),t._v("中，这样就能开始执行动画了；")]),t._v(" "),a("li",[t._v("调用"),a("code",[t._v("CALayer#removeAnimationForKey(_:)")]),t._v("方法停止动画；")])]),t._v(" "),a("p",[a("code",[t._v("CALayer#addAnimation(_:forKey:)")]),t._v("里的参数"),a("code",[t._v("forkey")]),t._v("没有太多别的要求，可以是任意字符串，甚至可以是"),a("code",[t._v("nil")]),t._v("。")]),t._v(" "),a("p",[a("strong",[t._v("CAPropertyAnimation")])]),t._v(" "),a("p",[a("code",[t._v("CAPropertyAnimation")]),t._v("继承"),a("code",[t._v("CAAnimation")]),t._v("，额外定义了一些属性：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("keyPath")]),t._v(" -- Specifies animated property. 譬如"),a("code",[t._v('"frame"')]),t._v("、"),a("code",[t._v('"position"')]),t._v("等；")]),t._v(" "),a("li",[a("code",[t._v("additive")]),t._v(" -- Determines if the value of the property is the value at the end of the previous repeat cycle, plus the value of the current repeat cycle. 不太懂！")]),t._v(" "),a("li",[a("code",[t._v("cumulative")]),t._v(" -- Determines if the value specified by the animation is added to the current render tree value to produce the new render tree value. 不太懂！")]),t._v(" "),a("li",[a("code",[t._v("valueFunction")]),t._v(" -- An optional value function that is applied to interpolated values. 很少会用到！")])]),t._v(" "),a("blockquote",[a("p",[t._v("Note: "),a("code",[t._v("CAPropertyAnimation")]),t._v("里的"),a("code",[t._v("keyPath")]),t._v("和"),a("code",[t._v("CALayer#addAnimation(_:forKey:)")]),t._v("里的"),a("code",[t._v("key")]),t._v("不一样，前者只能是"),a("code",[t._v('"frame"')]),t._v("、"),a("code",[t._v('"position"')]),t._v("之类的对应"),a("code",[t._v("CALayer")]),t._v("属性的字符串，后者可以是任意字符串，可以认为是给 animation 贴个 ID 标签。")])]),t._v(" "),a("h2",{attrs:{id:"cabasicanimation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cabasicanimation"}},[t._v("#")]),t._v(" CABasicAnimation")]),t._v(" "),a("p",[a("code",[t._v("CABasicAnimation")]),t._v("在继承"),a("code",[t._v("CAPropertyAnimation")]),t._v("的基础上又定义了三个属性：")]),t._v(" "),a("div",{staticClass:"language-objectivec extra-class"},[a("pre",{pre:!0,attrs:{class:"language-objectivec"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@interface")]),t._v(" CABasicAnimation "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CAPropertyAnimation\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nullable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" strong"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" id fromValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nullable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" strong"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" id toValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nullable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" strong"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" id byValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@end")]),t._v("\n")])])]),a("p",[a("code",[t._v("CAAnimation.h")]),t._v("里介绍了几种使用模式，一般来说，使用"),a("code",[t._v("fromValue")]),t._v("/"),a("code",[t._v("toValue")]),t._v("或"),a("code",[t._v("fromValue")]),t._v("/"),a("code",[t._v("byValue")]),t._v("组合即可，或者直接使用"),a("code",[t._v("byValue")]),t._v("或"),a("code",[t._v("toValue")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"cakeyframeanimation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cakeyframeanimation"}},[t._v("#")]),t._v(" CAKeyframeAnimation")]),t._v(" "),a("p",[t._v("Key frame animation 常被翻译为："),a("strong",[t._v("关键帧动画")]),t._v("。顾名思义，"),a("code",[t._v("CAKeyframeAnimation")]),t._v("可以实现让 animated properties 按照一串数值进行动画，就好像逐帧制作动画一样。")]),t._v(" "),a("blockquote",[a("p",[t._v("P.S: 不要被"),a("code",[t._v("CAKeyframeAnimation")]),t._v("中的 frame 所迷惑，它和"),a("code",[t._v("CALayer#frame")]),t._v("中的 frame 不是一回事儿。")])]),t._v(" "),a("p",[t._v("相较而言，"),a("code",[t._v("CABasicAnimation")]),t._v("处理动画更粗糙一些，只是单纯地让 layer 的属性值从 a 到 b；考虑到"),a("code",[t._v("CAKeyframeAnimation")]),t._v("的复杂性，这一部分对它的阐述会更详细一些。")]),t._v(" "),a("p",[a("strong",[t._v("Providing Keyframe Values")])]),t._v(" "),a("p",[t._v("动画处理的本质是改变属性值，"),a("code",[t._v("CABasicAnimation")]),t._v("提供了"),a("code",[t._v("fromValue")]),t._v("、"),a("code",[t._v("byValue")]),t._v("、"),a("code",[t._v("toValue")]),t._v("来「装载」待处理的属性值。")]),t._v(" "),a("p",[a("code",[t._v("CAKeyframeAnimation")]),t._v("处理动画更精细一些，动画过程中所需要指定的属性值自然更多（一般来说），因此提供了数组类型属性"),a("code",[t._v("values")]),t._v("来「装载」待处理的属性值。")]),t._v(" "),a("p",[t._v("举个例子，现在沿正方形路径移动一个 view，所经过的路径是"),a("code",[t._v("(100, 100)")]),t._v("->"),a("code",[t._v("(200, 100)")]),t._v("->"),a("code",[t._v("(200, 200)")]),t._v("->"),a("code",[t._v("(100, 200)")]),t._v("->"),a("code",[t._v("(100, 100)")]),t._v("，代码如下：")]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" kfa "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("CAKeyframeAnimation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("keyPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"position"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nkfa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("values "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("CGPoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("CGPoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 左上角")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("CGPoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("CGPoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 右上角")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("CGPoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("CGPoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 右下角")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("CGPoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("CGPoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 左下角")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("CGPoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("CGPoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 左上角")]),t._v("\nkfa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("duration "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.0")]),t._v("\nkfa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("removedOnCompletion "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\nkfa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fillMode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("kCAFillModeBoth")]),t._v("\n\nanimationView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("layer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addAnimation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("kfa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" forKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("nil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("除了"),a("code",[t._v("values")]),t._v("，"),a("code",[t._v("CAKeyframeAnimation")]),t._v("还提供了"),a("code",[t._v("path")]),t._v("属性，当使用"),a("code",[t._v("CAKeyframeAnimation")]),t._v("构建 point-based 的动画时，使用"),a("code",[t._v("path")]),t._v("是个不错的选择。")]),t._v(" "),a("blockquote",[a("p",[t._v("P.S: 显然，"),a("code",[t._v("values")]),t._v("和"),a("code",[t._v("path")]),t._v("只需要使用一个即可，然而，当同时赋予"),a("code",[t._v("values")]),t._v("和"),a("code",[t._v("path")]),t._v("以有效值，哪个会起作用呢？验证发现，当给"),a("code",[t._v("path")]),t._v("设置了有效值后，"),a("code",[t._v("values")]),t._v("的值就不会起作用。")])]),t._v(" "),a("p",[a("strong",[t._v("Keyframe Timing")])]),t._v(" "),a("p",[a("code",[t._v("values")]),t._v("将一个完整的动画分为 n 个关键帧（假设数组长度为 n），默认情况下，相邻帧之间的时间间隔为：duration/(n-1)。")]),t._v(" "),a("p",[t._v("但是"),a("code",[t._v("CAKeyframeAnimation")]),t._v("提供了丰富的接口以便进行更精密更丰富的自定义，相关属性包括："),a("code",[t._v("keyTimes")]),t._v("、"),a("code",[t._v("calculationMode")]),t._v("以及"),a("code",[t._v("timingFunctions")]),t._v("。")]),t._v(" "),a("p",[a("code",[t._v("keyTimes")]),t._v("也是数组类型，简单来说，"),a("code",[t._v("keyTimes")]),t._v("中的元素将动画时间切割成几部分，譬如"),a("code",[t._v("[0, 0.5, 1.0]")]),t._v("将时间切割为两部分：0-0.5"),a("em",[t._v("duration、0.5")]),t._v("duration-1.0*duration。")]),t._v(" "),a("blockquote",[a("p",[t._v("Note: 一般来说，"),a("code",[t._v("keyTimes")]),t._v("的元素个数和"),a("code",[t._v("values")]),t._v("的元素个数一致，或者与"),a("code",[t._v("path")]),t._v("的点的个数一致，否则，动画会出现想象不到的结果；但有特殊情况，下文会提到。")])]),t._v(" "),a("p",[a("code",[t._v("calculationMode")]),t._v("指示了关键帧之间的值如何计算，可选的值包括：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("kCAAnimationLinear")]),t._v("，默认值，线性过渡；")]),t._v(" "),a("li",[a("code",[t._v("kCAAnimationDiscrete")]),t._v("，从一个关键帧跳到下一个关键帧，直接跳跃，无过渡；")]),t._v(" "),a("li",[a("code",[t._v("kCAAnimationPaced")])]),t._v(" "),a("li",[a("code",[t._v("kCAAnimationCubic")])]),t._v(" "),a("li",[a("code",[t._v("kCAAnimationCubicPaced")])])]),t._v(" "),a("blockquote",[a("p",[t._v("P.S: "),a("code",[t._v("kCAAnimationLinear")]),t._v("和"),a("code",[t._v("kCAAnimationDiscrete")]),t._v("相对比较容易理解，后 3 种没怎么用到过，理解不深刻，希望以后能够补充。")])]),t._v(" "),a("p",[t._v("第三个属性"),a("code",[t._v("timingFunctions")]),t._v("和上文提到的"),a("code",[t._v("timingFunction")]),t._v("类似，只是这里是一个数组类型，它的每个元素控制的是两个相邻关键帧之间 timing curve。")]),t._v(" "),a("blockquote",[a("p",[t._v("Note: 若属性"),a("code",[t._v("values")]),t._v("中指定的关键帧个数为"),a("code",[t._v("n")]),t._v("（元素个数），则"),a("code",[t._v("timingFunctions")]),t._v("的元素个数应该为"),a("code",[t._v("n-1")]),t._v("。")])]),t._v(" "),a("p",[t._v("再着重介绍"),a("code",[t._v("keyTimes")]),t._v("配合"),a("code",[t._v("calculationMode")]),t._v("使用的注意事项：")]),t._v(" "),a("ul",[a("li",[t._v("如果"),a("code",[t._v("calculationMode")]),t._v("的值为"),a("code",[t._v("kCAAnimationLinear")]),t._v("或"),a("code",[t._v("kCAAnimationCubic")]),t._v("，"),a("code",[t._v("keyTimes")]),t._v("的第一个元素值必须为"),a("code",[t._v("0.0")]),t._v("，最后一个元素值必须为"),a("code",[t._v("1.0")]),t._v("，其他的元素值（如果有）范围在"),a("code",[t._v("0.0-1.0")]),t._v("之间；")]),t._v(" "),a("li",[t._v("如果"),a("code",[t._v("calculationMode")]),t._v("的值为"),a("code",[t._v("kCAAnimationDiscrete")]),t._v("，"),a("code",[t._v("keyTimes")]),t._v("的第一个元素值必须为"),a("code",[t._v("0.0")]),t._v("，最后一个元素值必须为"),a("code",[t._v("1.0")]),t._v("；此外，若"),a("code",[t._v("value")]),t._v("元素个数为"),a("code",[t._v("n")]),t._v("，则"),a("code",[t._v("keyTimes")]),t._v("的元素数量应该为"),a("code",[t._v("n+1")]),t._v("；")]),t._v(" "),a("li",[t._v("如果"),a("code",[t._v("calculationMode")]),t._v("的值为"),a("code",[t._v("kCAAnimationPaced")]),t._v("或"),a("code",[t._v("kCAAnimationCubicPaced")]),t._v("，"),a("code",[t._v("keyTimes")]),t._v("的值会被忽略。")])]),t._v(" "),a("p",[a("strong",[t._v("Rotation Mode Attribute")])]),t._v(" "),a("p",[a("code",[t._v("rotationMode")]),t._v(", it determines whether objects animating along the path rotate to match the path tangent.")]),t._v(" "),a("p",[t._v("该属性配合"),a("code",[t._v("path")]),t._v("使用，有三个可选值："),a("code",[t._v("nil")]),t._v("、"),a("code",[t._v("kCAAnimationRotateAuto")]),t._v("以及"),a("code",[t._v("kCAAnimationRotateAutoReverse")]),t._v("。设置一段曲线，配置相应的属性值，能较直观的感受到它们的作用。")]),t._v(" "),a("p",[a("strong",[t._v("Cubic Mode Attributes")])]),t._v(" "),a("p",[t._v("还有三个不常用到的属性："),a("code",[t._v("tensionValues")]),t._v("、"),a("code",[t._v("continuityValues")]),t._v("、"),a("code",[t._v("biasValues")]),t._v("。")]),t._v(" "),a("p",[t._v("它们仅在"),a("code",[t._v("calculationMode")]),t._v("属性值为"),a("code",[t._v("kCAAnimationCubic")]),t._v("或"),a("code",[t._v("kCAAnimationCubicPaced")]),t._v("时起作用。还没详细体会过，暂时略过。")]),t._v(" "),a("p",[t._v("关于"),a("code",[t._v("CAKeyframeAnimation")]),t._v("的更多内容参考"),a("a",{attrs:{href:"https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAKeyframeAnimation_class/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CAKeyframeAnimation Class Reference"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"catransition"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#catransition"}},[t._v("#")]),t._v(" CATransition")]),t._v(" "),a("p",[t._v("暂时略过，详细内容参考"),a("a",{attrs:{href:"https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CATransition_class/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CATransition Class Reference"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://www.cnblogs.com/ludashi/p/4160208.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS 开发之各种动画各种页面切面效果"),a("OutboundLink")],1),t._v("中还介绍了更多，只是使用这些私有资源会存在被 Apple Store 打回的风险。")]),t._v(" "),a("blockquote",[a("p",[t._v("P.S: 曾以为"),a("code",[t._v("CATransition")]),t._v("在转场动画中会用得比较多，但事实上，似乎用得并不多。")])]),t._v(" "),a("h2",{attrs:{id:"caanimationgroup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#caanimationgroup"}},[t._v("#")]),t._v(" CAAnimationGroup")]),t._v(" "),a("p",[t._v("每个"),a("code",[t._v("CAAnimation")]),t._v("只能处理一个 animated property，但有时候需要同时处理多个 animated properties，此时就会用到"),a("code",[t._v("CAAnimationGroup")]),t._v("。其定义非常简单：")]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CAAnimationGroup")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("CAAnimation")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" animations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("CAAnimation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("其用法就不消多说了，easy。")]),t._v(" "),a("h2",{attrs:{id:"本文参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本文参考"}},[t._v("#")]),t._v(" 本文参考")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAMediaTiming_protocol/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CAMediaTiming Protocol Reference"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAAnimation_class/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CAAnimation Class Reference"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CABasicAnimation_class/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CABasicAnimation Class Reference"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAKeyframeAnimation_class/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CAKeyframeAnimation Class Reference"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CATransition_class/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CATransition Class Reference"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAAnimationGroup_class/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CAAnimationGroup Class Reference"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://www.cnblogs.com/ludashi/p/4160208.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS 开发之各种动画各种页面切面效果"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=o.exports}}]);