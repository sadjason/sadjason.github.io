<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>显式动画 | 张不坏的博客</title>
    <meta name="description" content="Just For Fun">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.37bfab3d.css" as="style"><link rel="preload" href="/assets/js/app.50bca889.js" as="script"><link rel="preload" href="/assets/js/5.081d1701.js" as="script"><link rel="preload" href="/assets/js/64.d44fb0af.js" as="script"><link rel="prefetch" href="/assets/js/10.7bb33f06.js"><link rel="prefetch" href="/assets/js/100.014ff06c.js"><link rel="prefetch" href="/assets/js/101.28f11de0.js"><link rel="prefetch" href="/assets/js/102.be9d2e87.js"><link rel="prefetch" href="/assets/js/103.a1210d81.js"><link rel="prefetch" href="/assets/js/104.7101a956.js"><link rel="prefetch" href="/assets/js/105.833e6f80.js"><link rel="prefetch" href="/assets/js/106.978e1fc0.js"><link rel="prefetch" href="/assets/js/107.5af47fd0.js"><link rel="prefetch" href="/assets/js/108.efc3ce89.js"><link rel="prefetch" href="/assets/js/109.a69d6b5a.js"><link rel="prefetch" href="/assets/js/11.2de4afc9.js"><link rel="prefetch" href="/assets/js/110.30984b63.js"><link rel="prefetch" href="/assets/js/12.bfc099bd.js"><link rel="prefetch" href="/assets/js/13.20253e0d.js"><link rel="prefetch" href="/assets/js/14.67131b1c.js"><link rel="prefetch" href="/assets/js/15.1af26cbd.js"><link rel="prefetch" href="/assets/js/16.4b261ee0.js"><link rel="prefetch" href="/assets/js/17.1216332f.js"><link rel="prefetch" href="/assets/js/18.c0159773.js"><link rel="prefetch" href="/assets/js/19.0f007f87.js"><link rel="prefetch" href="/assets/js/2.b4633a05.js"><link rel="prefetch" href="/assets/js/20.4b295001.js"><link rel="prefetch" href="/assets/js/21.0c46767c.js"><link rel="prefetch" href="/assets/js/22.a5e065ea.js"><link rel="prefetch" href="/assets/js/23.f43a6a7e.js"><link rel="prefetch" href="/assets/js/24.245f4f15.js"><link rel="prefetch" href="/assets/js/25.618f74a1.js"><link rel="prefetch" href="/assets/js/26.274a606b.js"><link rel="prefetch" href="/assets/js/27.c2d8fe18.js"><link rel="prefetch" href="/assets/js/28.5c522d2a.js"><link rel="prefetch" href="/assets/js/29.c90fdb1a.js"><link rel="prefetch" href="/assets/js/3.9babd8f1.js"><link rel="prefetch" href="/assets/js/30.1ccbdebc.js"><link rel="prefetch" href="/assets/js/31.acf3eca6.js"><link rel="prefetch" href="/assets/js/32.ccfdc859.js"><link rel="prefetch" href="/assets/js/33.9b262756.js"><link rel="prefetch" href="/assets/js/34.c59a4044.js"><link rel="prefetch" href="/assets/js/35.2b10fefb.js"><link rel="prefetch" href="/assets/js/36.2daeeb7b.js"><link rel="prefetch" href="/assets/js/37.d649866c.js"><link rel="prefetch" href="/assets/js/38.aba1ac95.js"><link rel="prefetch" href="/assets/js/39.58a95fd1.js"><link rel="prefetch" href="/assets/js/4.a7413ce2.js"><link rel="prefetch" href="/assets/js/40.8ef4d374.js"><link rel="prefetch" href="/assets/js/41.5799de7a.js"><link rel="prefetch" href="/assets/js/42.b7ee7489.js"><link rel="prefetch" href="/assets/js/43.28a65d64.js"><link rel="prefetch" href="/assets/js/44.90f92ea2.js"><link rel="prefetch" href="/assets/js/45.30b683fd.js"><link rel="prefetch" href="/assets/js/46.f57ccc19.js"><link rel="prefetch" href="/assets/js/47.7a82bd74.js"><link rel="prefetch" href="/assets/js/48.72503020.js"><link rel="prefetch" href="/assets/js/49.3a4ba077.js"><link rel="prefetch" href="/assets/js/50.0c3297f3.js"><link rel="prefetch" href="/assets/js/51.e9ba9363.js"><link rel="prefetch" href="/assets/js/52.473ee9ff.js"><link rel="prefetch" href="/assets/js/53.166d6e7a.js"><link rel="prefetch" href="/assets/js/54.78af3662.js"><link rel="prefetch" href="/assets/js/55.f0d54751.js"><link rel="prefetch" href="/assets/js/56.5de81531.js"><link rel="prefetch" href="/assets/js/57.6e18322f.js"><link rel="prefetch" href="/assets/js/58.1fccc879.js"><link rel="prefetch" href="/assets/js/59.773775e1.js"><link rel="prefetch" href="/assets/js/6.0c9cc532.js"><link rel="prefetch" href="/assets/js/60.0d665185.js"><link rel="prefetch" href="/assets/js/61.d9ae36dc.js"><link rel="prefetch" href="/assets/js/62.fb5e3b65.js"><link rel="prefetch" href="/assets/js/63.5ace8fda.js"><link rel="prefetch" href="/assets/js/65.ed8fe56f.js"><link rel="prefetch" href="/assets/js/66.809078da.js"><link rel="prefetch" href="/assets/js/67.2489499e.js"><link rel="prefetch" href="/assets/js/68.e3ee952d.js"><link rel="prefetch" href="/assets/js/69.071411f8.js"><link rel="prefetch" href="/assets/js/7.8188415c.js"><link rel="prefetch" href="/assets/js/70.be8269cf.js"><link rel="prefetch" href="/assets/js/71.a320347a.js"><link rel="prefetch" href="/assets/js/72.f4fda48b.js"><link rel="prefetch" href="/assets/js/73.0f9f9284.js"><link rel="prefetch" href="/assets/js/74.b4028d07.js"><link rel="prefetch" href="/assets/js/75.6d63415f.js"><link rel="prefetch" href="/assets/js/76.d5b4df24.js"><link rel="prefetch" href="/assets/js/77.62b794e1.js"><link rel="prefetch" href="/assets/js/78.63e767ab.js"><link rel="prefetch" href="/assets/js/79.45056905.js"><link rel="prefetch" href="/assets/js/8.20d7cb0f.js"><link rel="prefetch" href="/assets/js/80.e06c5521.js"><link rel="prefetch" href="/assets/js/81.bc82bd01.js"><link rel="prefetch" href="/assets/js/82.4aeb6081.js"><link rel="prefetch" href="/assets/js/83.3ed6146f.js"><link rel="prefetch" href="/assets/js/84.f2aff9f4.js"><link rel="prefetch" href="/assets/js/85.2b8f4e50.js"><link rel="prefetch" href="/assets/js/86.27aea1da.js"><link rel="prefetch" href="/assets/js/87.7f5dc71e.js"><link rel="prefetch" href="/assets/js/88.9ca6511c.js"><link rel="prefetch" href="/assets/js/89.e8f54ad1.js"><link rel="prefetch" href="/assets/js/9.ee6c43f7.js"><link rel="prefetch" href="/assets/js/90.9abac718.js"><link rel="prefetch" href="/assets/js/91.9d8f5f36.js"><link rel="prefetch" href="/assets/js/92.2277b907.js"><link rel="prefetch" href="/assets/js/93.efca2f57.js"><link rel="prefetch" href="/assets/js/94.e9cc0386.js"><link rel="prefetch" href="/assets/js/95.fa3326f7.js"><link rel="prefetch" href="/assets/js/96.82bafc57.js"><link rel="prefetch" href="/assets/js/97.da22d13e.js"><link rel="prefetch" href="/assets/js/98.d745e5ec.js"><link rel="prefetch" href="/assets/js/99.79a6f693.js">
    <link rel="stylesheet" href="/assets/css/0.styles.37bfab3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><div class="navbar"><div class="navbar-content"><div class="slogan">Valar Morghulis</div> <div class="links"><span class="link-item"><a href="/">首页</a></span> <span class="link-item"><a href="/category/iOS/">iOS</a></span> <span class="link-item"><a href="/category/other/">其他</a></span></div></div></div> <div class="content-header"><div class="post-title">显式动画</div> <div class="post-info">2016-06-27 • iOS</div></div> <div class="content content__default"><p><strong>隐式动画</strong>是在 iOS 平台创建动态用户界面的一种直接方式，也是<code>UIKit</code>动画机制的基础，不过它并不能涵盖所有的动画类型。本文旨在要研究<strong>显式动画</strong>，它能够对一些属性做指定的自定义动画，或者创建非线性动画，比如沿着任意一条曲线移动。</p> <h2 id="caanimation-简介"><a href="#caanimation-简介" class="header-anchor">#</a> CAAnimation 简介</h2> <p>研究显式动画的关键是分析<code>CAAnimation</code>及其子类，<code>CAAnimation</code>和其子类的继承体系如下：</p> <div class="language-textile extra-class"><pre class="language-textile"><code><span class="token phrase"><span class="token table"><span class="token punctuation">|</span>--CAAnimation: CAMediaTiming
   <span class="token punctuation">|</span>--CAPropertyAnimation
      <span class="token punctuation">|</span>--CABasicAnimation
      <span class="token punctuation">|</span>--CAKeyframeAnimation
   <span class="token punctuation">|</span>--CATransition
   <span class="token punctuation">|</span></span>--CAAnimationGroup
</span></code></pre></div><p>一般情况下不直接使用<code>CAAnimation</code>，而使用其子类；并且<code>CAPropertyAnimation</code>也不能直接使用。</p> <p><code>CAAnimation</code>遵循<code>CAMediaTiming</code>协议，常用属性包括：</p> <ul><li><code>beginTime</code> -- 控制动画开始时间，譬如<code>CACurrentMediaTime()+1.0</code>对应的是 1 秒的 delay；</li> <li><code>duration</code> -- 控制动画的持续时间；</li> <li><code>repeatCount</code> -- 动画的重复次数，永久重复对应<code>HUGE_VALF</code>，<code>1</code>表不重复；</li> <li><code>timingFunction</code> -- 控制动画运行的节奏，一般使用<code>CAMediaTimingFunction(name:)</code>赋值，<code>name</code>可设置为：
<ul><li><code>kCAMediaTimingFunctionLinear</code></li> <li><code>kCAMediaTimingFunctionEaseIn</code></li> <li><code>kCAMediaTimingFunctionEaseOut</code></li> <li><code>kCAMediaTimingFunctionEaseInEaseOut</code></li> <li><code>kCAMediaTimingFunctionDefault</code></li></ul></li> <li><code>delegate</code> -- 动画代理，用来监听动画的执行过程，两个方法：
<ul><li><code>func animationDidStart(animation: CAAnimation)</code></li> <li><code>func animationDidStop(animation: CAAnimation, finished flag: Bool)</code></li></ul></li> <li><code>removedOnCompletion</code> -- 当设置为<code>true</code>时，动画完成后，layer 又会回到原处；当设置为<code>false</code>，且<code>fillMode</code>设置为<code>kCAFillModeForwards</code>时，layer 动画完成后不动；</li> <li><code>fillMode</code> -- determine how the timed object behaves once its active duration has completed.</li></ul> <p>额外阐述一下<code>fillMode</code>属性。在此之前先引入几个概念，经历一个完整动画的 layer 的时间线可分为 3 个部分：</p> <ul><li><strong>动画前</strong> -- 添加动画到动画开始前的时间段；</li> <li><strong>动画中</strong> -- 动画开始到结束的时间段；</li> <li><strong>动画后</strong> -- 动画结束后的时间；</li></ul> <p>动画的实质是 layer 的属性值从某个值到另一个值的变化过程，站在属性值的角度同样有 3 个概念：</p> <ul><li>origin value -- 添加动画前的属性值</li> <li>from value -- 动画的初始值</li> <li>to value -- 动画的结束值</li></ul> <p><code>fillMode</code>的属性值会影响 layer 在<strong>动画前</strong>和<strong>动画后</strong>的行为，有 4 种可设置的属性值：</p> <ul><li><code>kCAFillModeRemoved</code> -- 此为默认值，layer 在<strong>动画前</strong>的属性值一直未 origin value，动画开始时属性值立马切换到 from value，然后动画变化到 to value，动画结束时属性值又立马切换到 origin value；</li> <li><code>kCAFillModeForwards</code> -- 相对于<code>kCAFillModeRemoved</code>，layer 在动画结束时仍然保持属性值为 to value；</li> <li><code>kCAFillModeBackwards</code> -- 相对于<code>kCAFillModeRemoved</code>，layer 在动画前就将属性值切换到 origin value；</li> <li><code>kCAFillModeBoth</code> -- <code>kCAFillModeForwards</code>和<code>kCAFillModeBackwards</code>的合体；</li></ul> <blockquote><p>Note: <code>kCAFillModeForwards</code>起作用的前提是<code>removedOnCompletion</code>的属性值被设置为<code>false</code>，<code>kCAFillModeBackwards</code>的作用在 delay 不为 0 时才能直观感受到，更多内容参考<a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAMediaTiming_protocol/index.html#//apple_ref/doc/constant_group/Fill_Modes" target="_blank" rel="noopener noreferrer">CAMediaTiming -- Fill Modes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></blockquote> <p><strong>使用 CAAnimation 的基本套路</strong></p> <p>使用<code>CAAnimation</code>（或者其子类）的基本套路是：</p> <ol><li>初始化一个<code>CAAnimation</code>对象，并设置一些动画相关属性；</li> <li>调用<code>CALayer#addAnimation(_:forKey:)</code>方法添加<code>CAAnimation</code>对象到<code>CALayer</code>中，这样就能开始执行动画了；</li> <li>调用<code>CALayer#removeAnimationForKey(_:)</code>方法停止动画；</li></ol> <p><code>CALayer#addAnimation(_:forKey:)</code>里的参数<code>forkey</code>没有太多别的要求，可以是任意字符串，甚至可以是<code>nil</code>。</p> <p><strong>CAPropertyAnimation</strong></p> <p><code>CAPropertyAnimation</code>继承<code>CAAnimation</code>，额外定义了一些属性：</p> <ul><li><code>keyPath</code> -- Specifies animated property. 譬如<code>&quot;frame&quot;</code>、<code>&quot;position&quot;</code>等；</li> <li><code>additive</code> -- Determines if the value of the property is the value at the end of the previous repeat cycle, plus the value of the current repeat cycle. 不太懂！</li> <li><code>cumulative</code> -- Determines if the value specified by the animation is added to the current render tree value to produce the new render tree value. 不太懂！</li> <li><code>valueFunction</code> -- An optional value function that is applied to interpolated values. 很少会用到！</li></ul> <blockquote><p>Note: <code>CAPropertyAnimation</code>里的<code>keyPath</code>和<code>CALayer#addAnimation(_:forKey:)</code>里的<code>key</code>不一样，前者只能是<code>&quot;frame&quot;</code>、<code>&quot;position&quot;</code>之类的对应<code>CALayer</code>属性的字符串，后者可以是任意字符串，可以认为是给 animation 贴个 ID 标签。</p></blockquote> <h2 id="cabasicanimation"><a href="#cabasicanimation" class="header-anchor">#</a> CABasicAnimation</h2> <p><code>CABasicAnimation</code>在继承<code>CAPropertyAnimation</code>的基础上又定义了三个属性：</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token keyword">@interface</span> CABasicAnimation <span class="token punctuation">:</span> CAPropertyAnimation

<span class="token keyword">@property</span><span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> id fromValue<span class="token punctuation">;</span>
<span class="token keyword">@property</span><span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> id toValue<span class="token punctuation">;</span>
<span class="token keyword">@property</span><span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> id byValue<span class="token punctuation">;</span>

<span class="token keyword">@end</span>
</code></pre></div><p><code>CAAnimation.h</code>里介绍了几种使用模式，一般来说，使用<code>fromValue</code>/<code>toValue</code>或<code>fromValue</code>/<code>byValue</code>组合即可，或者直接使用<code>byValue</code>或<code>toValue</code>。</p> <h2 id="cakeyframeanimation"><a href="#cakeyframeanimation" class="header-anchor">#</a> CAKeyframeAnimation</h2> <p>Key frame animation 常被翻译为：<strong>关键帧动画</strong>。顾名思义，<code>CAKeyframeAnimation</code>可以实现让 animated properties 按照一串数值进行动画，就好像逐帧制作动画一样。</p> <blockquote><p>P.S: 不要被<code>CAKeyframeAnimation</code>中的 frame 所迷惑，它和<code>CALayer#frame</code>中的 frame 不是一回事儿。</p></blockquote> <p>相较而言，<code>CABasicAnimation</code>处理动画更粗糙一些，只是单纯地让 layer 的属性值从 a 到 b；考虑到<code>CAKeyframeAnimation</code>的复杂性，这一部分对它的阐述会更详细一些。</p> <p><strong>Providing Keyframe Values</strong></p> <p>动画处理的本质是改变属性值，<code>CABasicAnimation</code>提供了<code>fromValue</code>、<code>byValue</code>、<code>toValue</code>来「装载」待处理的属性值。</p> <p><code>CAKeyframeAnimation</code>处理动画更精细一些，动画过程中所需要指定的属性值自然更多（一般来说），因此提供了数组类型属性<code>values</code>来「装载」待处理的属性值。</p> <p>举个例子，现在沿正方形路径移动一个 view，所经过的路径是<code>(100, 100)</code>-&gt;<code>(200, 100)</code>-&gt;<code>(200, 200)</code>-&gt;<code>(100, 200)</code>-&gt;<code>(100, 100)</code>，代码如下：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> kfa <span class="token operator">=</span> <span class="token function">CAKeyframeAnimation</span><span class="token punctuation">(</span>keyPath<span class="token punctuation">:</span> <span class="token string">&quot;position&quot;</span><span class="token punctuation">)</span>

kfa<span class="token punctuation">.</span>values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">NSValue</span><span class="token punctuation">(</span><span class="token builtin">CGPoint</span><span class="token punctuation">:</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">// 左上角</span>
              <span class="token function">NSValue</span><span class="token punctuation">(</span><span class="token builtin">CGPoint</span><span class="token punctuation">:</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">// 右上角</span>
              <span class="token function">NSValue</span><span class="token punctuation">(</span><span class="token builtin">CGPoint</span><span class="token punctuation">:</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">// 右下角</span>
              <span class="token function">NSValue</span><span class="token punctuation">(</span><span class="token builtin">CGPoint</span><span class="token punctuation">:</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">// 左下角</span>
              <span class="token function">NSValue</span><span class="token punctuation">(</span><span class="token builtin">CGPoint</span><span class="token punctuation">:</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token comment">// 左上角</span>
kfa<span class="token punctuation">.</span>duration <span class="token operator">=</span> <span class="token number">4.0</span>
kfa<span class="token punctuation">.</span>removedOnCompletion <span class="token operator">=</span> <span class="token boolean">false</span>
kfa<span class="token punctuation">.</span>fillMode <span class="token operator">=</span> <span class="token constant">kCAFillModeBoth</span>

animationView<span class="token punctuation">.</span>layer<span class="token punctuation">.</span><span class="token function">addAnimation</span><span class="token punctuation">(</span>kfa<span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token constant">nil</span><span class="token punctuation">)</span>
</code></pre></div><p>除了<code>values</code>，<code>CAKeyframeAnimation</code>还提供了<code>path</code>属性，当使用<code>CAKeyframeAnimation</code>构建 point-based 的动画时，使用<code>path</code>是个不错的选择。</p> <blockquote><p>P.S: 显然，<code>values</code>和<code>path</code>只需要使用一个即可，然而，当同时赋予<code>values</code>和<code>path</code>以有效值，哪个会起作用呢？验证发现，当给<code>path</code>设置了有效值后，<code>values</code>的值就不会起作用。</p></blockquote> <p><strong>Keyframe Timing</strong></p> <p><code>values</code>将一个完整的动画分为 n 个关键帧（假设数组长度为 n），默认情况下，相邻帧之间的时间间隔为：duration/(n-1)。</p> <p>但是<code>CAKeyframeAnimation</code>提供了丰富的接口以便进行更精密更丰富的自定义，相关属性包括：<code>keyTimes</code>、<code>calculationMode</code>以及<code>timingFunctions</code>。</p> <p><code>keyTimes</code>也是数组类型，简单来说，<code>keyTimes</code>中的元素将动画时间切割成几部分，譬如<code>[0, 0.5, 1.0]</code>将时间切割为两部分：0-0.5<em>duration、0.5</em>duration-1.0*duration。</p> <blockquote><p>Note: 一般来说，<code>keyTimes</code>的元素个数和<code>values</code>的元素个数一致，或者与<code>path</code>的点的个数一致，否则，动画会出现想象不到的结果；但有特殊情况，下文会提到。</p></blockquote> <p><code>calculationMode</code>指示了关键帧之间的值如何计算，可选的值包括：</p> <ul><li><code>kCAAnimationLinear</code>，默认值，线性过渡；</li> <li><code>kCAAnimationDiscrete</code>，从一个关键帧跳到下一个关键帧，直接跳跃，无过渡；</li> <li><code>kCAAnimationPaced</code></li> <li><code>kCAAnimationCubic</code></li> <li><code>kCAAnimationCubicPaced</code></li></ul> <blockquote><p>P.S: <code>kCAAnimationLinear</code>和<code>kCAAnimationDiscrete</code>相对比较容易理解，后 3 种没怎么用到过，理解不深刻，希望以后能够补充。</p></blockquote> <p>第三个属性<code>timingFunctions</code>和上文提到的<code>timingFunction</code>类似，只是这里是一个数组类型，它的每个元素控制的是两个相邻关键帧之间 timing curve。</p> <blockquote><p>Note: 若属性<code>values</code>中指定的关键帧个数为<code>n</code>（元素个数），则<code>timingFunctions</code>的元素个数应该为<code>n-1</code>。</p></blockquote> <p>再着重介绍<code>keyTimes</code>配合<code>calculationMode</code>使用的注意事项：</p> <ul><li>如果<code>calculationMode</code>的值为<code>kCAAnimationLinear</code>或<code>kCAAnimationCubic</code>，<code>keyTimes</code>的第一个元素值必须为<code>0.0</code>，最后一个元素值必须为<code>1.0</code>，其他的元素值（如果有）范围在<code>0.0-1.0</code>之间；</li> <li>如果<code>calculationMode</code>的值为<code>kCAAnimationDiscrete</code>，<code>keyTimes</code>的第一个元素值必须为<code>0.0</code>，最后一个元素值必须为<code>1.0</code>；此外，若<code>value</code>元素个数为<code>n</code>，则<code>keyTimes</code>的元素数量应该为<code>n+1</code>；</li> <li>如果<code>calculationMode</code>的值为<code>kCAAnimationPaced</code>或<code>kCAAnimationCubicPaced</code>，<code>keyTimes</code>的值会被忽略。</li></ul> <p><strong>Rotation Mode Attribute</strong></p> <p><code>rotationMode</code>, it determines whether objects animating along the path rotate to match the path tangent.</p> <p>该属性配合<code>path</code>使用，有三个可选值：<code>nil</code>、<code>kCAAnimationRotateAuto</code>以及<code>kCAAnimationRotateAutoReverse</code>。设置一段曲线，配置相应的属性值，能较直观的感受到它们的作用。</p> <p><strong>Cubic Mode Attributes</strong></p> <p>还有三个不常用到的属性：<code>tensionValues</code>、<code>continuityValues</code>、<code>biasValues</code>。</p> <p>它们仅在<code>calculationMode</code>属性值为<code>kCAAnimationCubic</code>或<code>kCAAnimationCubicPaced</code>时起作用。还没详细体会过，暂时略过。</p> <p>关于<code>CAKeyframeAnimation</code>的更多内容参考<a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAKeyframeAnimation_class/" target="_blank" rel="noopener noreferrer">CAKeyframeAnimation Class Reference<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="catransition"><a href="#catransition" class="header-anchor">#</a> CATransition</h2> <p>暂时略过，详细内容参考<a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CATransition_class/" target="_blank" rel="noopener noreferrer">CATransition Class Reference<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p><a href="http://www.cnblogs.com/ludashi/p/4160208.html" target="_blank" rel="noopener noreferrer">iOS 开发之各种动画各种页面切面效果<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中还介绍了更多，只是使用这些私有资源会存在被 Apple Store 打回的风险。</p> <blockquote><p>P.S: 曾以为<code>CATransition</code>在转场动画中会用得比较多，但事实上，似乎用得并不多。</p></blockquote> <h2 id="caanimationgroup"><a href="#caanimationgroup" class="header-anchor">#</a> CAAnimationGroup</h2> <p>每个<code>CAAnimation</code>只能处理一个 animated property，但有时候需要同时处理多个 animated properties，此时就会用到<code>CAAnimationGroup</code>。其定义非常简单：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CAAnimationGroup</span> <span class="token punctuation">:</span> <span class="token builtin">CAAnimation</span> <span class="token punctuation">{</span>  
  <span class="token keyword">public</span> <span class="token keyword">var</span> animations<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">CAAnimation</span><span class="token punctuation">]</span><span class="token operator">?</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其用法就不消多说了，easy。</p> <h2 id="本文参考"><a href="#本文参考" class="header-anchor">#</a> 本文参考</h2> <ul><li><a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAMediaTiming_protocol/" target="_blank" rel="noopener noreferrer">CAMediaTiming Protocol Reference<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAAnimation_class/" target="_blank" rel="noopener noreferrer">CAAnimation Class Reference<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CABasicAnimation_class/" target="_blank" rel="noopener noreferrer">CABasicAnimation Class Reference<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAKeyframeAnimation_class/" target="_blank" rel="noopener noreferrer">CAKeyframeAnimation Class Reference<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CATransition_class/" target="_blank" rel="noopener noreferrer">CATransition Class Reference<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAAnimationGroup_class/" target="_blank" rel="noopener noreferrer">CAAnimationGroup Class Reference<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.cnblogs.com/ludashi/p/4160208.html" target="_blank" rel="noopener noreferrer">iOS 开发之各种动画各种页面切面效果<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.50bca889.js" defer></script><script src="/assets/js/5.081d1701.js" defer></script><script src="/assets/js/64.d44fb0af.js" defer></script>
  </body>
</html>
