(window.webpackJsonp=window.webpackJsonp||[]).push([[105],{157:function(t,n,e){"use strict";e.r(n);var a=e(0),s=Object(a.a)({},(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("实现可交互的自定义转场动画的关键在于：定义遵循"),e("code",[t._v("UIViewControllerInteractiveTransitioning")]),t._v("协议的类。")]),t._v(" "),e("p",[e("code",[t._v("UIViewControllerInteractiveTransitioning")]),t._v("协议的内容如下：")]),t._v(" "),e("div",{staticClass:"language-swift extra-class"},[e("pre",{pre:!0,attrs:{class:"language-swift"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protocol")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("UIViewControllerInteractiveTransitioning")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("NSObjectProtocol")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("startInteractiveTransition")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transitionContext"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("UIViewControllerContextTransitioning")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("optional")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("completionSpeed")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("CGFloat")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("optional")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("completionCurve")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("UIViewAnimationCurve")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("到现在我都没搞明白如何定义遵循"),e("code",[t._v("UIViewControllerInteractiveTransitioning")]),t._v("的类。")]),t._v(" "),e("p",[t._v("但正如 Apple"),e("a",{attrs:{href:"https://developer.apple.com/library/prerelease/content/featuredarticles/ViewControllerPGforiPhoneOS/CustomizingtheTransitionAnimations.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("文档"),e("OutboundLink")],1),t._v("所言：")]),t._v(" "),e("blockquote",[e("p",[t._v("The easiest way to make your animations interactive is to use a "),e("code",[t._v("UIPercentDrivenInteractiveTransition")]),t._v(" object.")])]),t._v(" "),e("p",[t._v("简单来说，创建遵循"),e("code",[t._v("UIViewControllerInteractiveTransitioning")]),t._v("协议的类型的最简单方式是继承"),e("code",[t._v("UIPercentDrivenInteractiveTransition")]),t._v("类。")]),t._v(" "),e("p",[t._v("这是一个遵循"),e("code",[t._v("UIViewControllerInteractiveTransitioning")]),t._v("协议的类，为我们预先实现和提供了一系列便利的方法，可以用一个百分比来控制交互式切换的过程。")]),t._v(" "),e("p",[t._v("该类的内容及介绍如下：")]),t._v(" "),e("div",{staticClass:"language-swift extra-class"},[e("pre",{pre:!0,attrs:{class:"language-swift"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UIPercentDrivenInteractiveTransition")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("NSObject")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("UIViewControllerInteractiveTransitioning")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只读，对应的是animation controller的transitionDuration(_:)返回值")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" duration"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("CGFloat")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 交互动画完成度（百分比），updateInteractiveTransition(_:)会改变该值")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" percentComplete"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("CGFloat")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 影响completion animation duration，一般设置为1.0（默认值），")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对应的completion animation duration为(1 - percentComplete)*duration.")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" completionSpeed"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("CGFloat")]),t._v("\n    \n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// completion animation的timing curve，默认是.EaseInOut")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" completionCurve"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("UIViewAnimationCurve")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 这三个方法在gesture recognizer的处理逻辑中调用 */")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 更新百分比，一般通过手势识别的长度之类的来计算一个值，然后进行更新")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateInteractiveTransition")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("percentComplete"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("CGFloat")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 报告交互取消，返回切换前的状态")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cancelInteractiveTransition")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 报告交互完成，更新到切换后的状态")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("finishInteractiveTransition")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[e("code",[t._v("UIPercentDrivenInteractiveTransition")]),t._v("的内容并不复杂，使用时需要注意的是，interaction controller 不能孤立存在，需要配合 animation controller 工作；换句话说，具体的 transition 仍然在 animation controller 的"),e("code",[t._v("animateTransition(_:)")]),t._v("中完成。")]),t._v(" "),e("p",[t._v("此外，在定义 animation controller 的"),e("code",[t._v("animateTransition(_:)")]),t._v("方法时，不要忘记调用"),e("code",[t._v("UIViewControllerContextTransitioning")]),t._v("的"),e("code",[t._v("completeTransition(_:)")]),t._v("方法。")]),t._v(" "),e("blockquote",[e("p",[t._v("P.S: 根据我的理解并验证，"),e("code",[t._v("UIViewControllerContextTransitioning#completeTransition(true)")]),t._v("的作用效果之一是将 from view 从 container view 中移除掉。")])]),t._v(" "),e("p",[t._v("基于"),e("code",[t._v("UIPercentDrivenInteractiveTransition")]),t._v("做了个简单的 Demo，如下图：")]),t._v(" "),e("e-img",{attrs:{src:"/image/shrinking-modal-interactive-transition.gif",alt:"Shrinking Modal Interactive Transition"}}),t._v(" "),e("p",[t._v("代码详见"),e("a",{attrs:{href:"https://github.com/sadjason/ShrinkingModalInteractiveTransitionDemo",target:"_blank",rel:"noopener noreferrer"}},[t._v("Github"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("p",[e("code",[t._v("UIViewControllerTransitioning.h")]),t._v("中对"),e("code",[t._v("UIPercentDrivenInteractiveTransition")]),t._v("有一段说明，不是特别理解：")]),t._v(" "),e("blockquote",[e("p",[t._v("This style of interaction controller should only be used with an animator that implements a CA style transition in the animator's animateTransition: method.")])]),t._v(" "),e("p",[t._v("掌握使用"),e("code",[t._v("UIPercentDrivenInteractiveTransition")]),t._v("并不难，但是该类有哪些限制（或缺陷）呢？我有该如何抛开该类自定义实现 interaction controller 呢？")]),t._v(" "),e("h2",{attrs:{id:"本文参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本文参考"}},[t._v("#")]),t._v(" 本文参考")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://onevcat.com/2013/10/vc-transition-in-ios7/",target:"_blank",rel:"noopener noreferrer"}},[t._v("WWDC 2013 Session 笔记 - iOS7 中的 ViewController 切换"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIViewControllerInteractiveTransitioning_protocol/",target:"_blank",rel:"noopener noreferrer"}},[t._v("UIViewControllerInteractiveTransitioning Protocol Reference"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"http://initwithfunk.com/blog/2014/05/22/interactive-animated-transitions-on-ios/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Interactive Animated Transitions on iOS"),e("OutboundLink")],1)])])],1)}),[],!1,null,null,null);n.default=s.exports}}]);