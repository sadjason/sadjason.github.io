(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{110:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[s("strong",[t._v("写在前面")])]),t._v(" "),s("p",[t._v("2016 年 07 月初入职场，因为工作需要，接触了 ReactiveCocoa（也常称为"),s("em",[t._v("RAC")]),t._v("）。彼时，正如前辈所告知的那样：ReactiveCocoa 的学习曲线较陡峭。或许是我网络搜索能力欠佳，那时很难在网上找到比较靠谱的 RAC 中文资料。然而比较幸运的是，我司大神臧成威恰好那时在内部开辟了系列 RAC 视频教学，让我的 RAC 学习经历没那么痛苦。另外，值得一提的是，美团几篇公开的"),s("a",{attrs:{href:"https://tech.meituan.com/talk-about-reactivecocoas-cold-signal-and-hot-signal-part-1.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ReactiveCocoa 技术博客"),s("OutboundLink")],1),t._v("仍然是 RAC 初学者不得不看的优质资料。")]),t._v(" "),s("p",[t._v("这一两年来，时至今日（2017 年尾），网络上优质的 RAC 博客慢慢多起来了，基于这些优质的博客，RAC 的「学习陡峭」问题其实已经有明显好转。")]),t._v(" "),s("p",[t._v("我在学习 RAC 过程中，记录了不少的学习笔记，趁闲整理一下，大概包括如下几个部分：")]),t._v(" "),s("ul",[s("li",[t._v("信号（"),s("code",[t._v("RACSignal")]),t._v("）的简单使用和基本操作")]),t._v(" "),s("li",[t._v("ReactiveCocoa 的内存管理")]),t._v(" "),s("li",[t._v("ReactiveCocoa 与多线程")])]),t._v(" "),s("p",[t._v("我个人认为，搞清楚了如上这三个方面的内容，基本上就可以上手使用 ReactiveCocoa 进行开发了。当然，"),s("code",[t._v("RACCommand")]),t._v("也是要了解的，后者的内部实现比较复杂，但使用起来还是蛮方便的，可能也会在后面博客中涉及它。至于其他相关概念，譬如"),s("code",[t._v("RACScheduler")]),t._v("、"),s("code",[t._v("RACSubject")]),t._v("，实现相对简单，遇到问题看源码基本就可以解决。")]),t._v(" "),s("p",[t._v("本文总结的内容围绕"),s("code",[t._v("RACSignal")]),t._v("，包括：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("RACSignal")]),t._v("的简单使用\n"),s("ul",[s("li",[t._v("获取信号")]),t._v(" "),s("li",[t._v("订阅信号")]),t._v(" "),s("li",[t._v("订阅过程")])])]),t._v(" "),s("li",[s("code",[t._v("RACSignal")]),t._v("的基本操作\n"),s("ul",[s("li",[t._v("单个信号的变换")]),t._v(" "),s("li",[t._v("多个信号的组合")])])])]),t._v(" "),s("p",[t._v("Signal 传递的 data 是 event，它所传递的 event 包括 3 种："),s("em",[t._v("值事件")]),t._v("、"),s("em",[t._v("完成事件")]),t._v("和"),s("em",[t._v("错误事件")]),t._v("。其中在传递值事件时，可以携带数据。落实到代码层面，传递值事件/完成事件/错误事件的本质就是向 subscriber 发送"),s("code",[t._v("sendNext:")]),t._v("、"),s("code",[t._v("sendComplete")]),t._v("以及"),s("code",[t._v("sendError:")]),t._v("消息。")]),t._v(" "),s("p",[t._v("为了更形象对各种操作进行表述，下文会大量使用图例，绿色圆圈代表值事件，红色叉代表错误事件，红色杠代表完成事件，灰色带箭头直线代表时间线，如下：")]),t._v(" "),s("e-img",{attrs:{src:"/image/signal-symbols@2x.png"}}),t._v(" "),s("p",[t._v("Signal 在其生命周期内，可以传递任意多个值事件，但最多只能传递一个完成事件或错误事件；换句话说，一旦 Signal 的事件流中出现了错误事件或者完成事件，之后产生的任何事件都是无效的。")]),t._v(" "),s("h2",{attrs:{id:"信号的简单使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#信号的简单使用"}},[t._v("#")]),t._v(" 信号的简单使用")]),t._v(" "),s("p",[t._v("这一部分将从 3 个方面介绍信号的简单实用，包括：创建信号、订阅信号、订阅过程。")]),t._v(" "),s("h3",{attrs:{id:"获取信号"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取信号"}},[t._v("#")]),t._v(" 获取信号")]),t._v(" "),s("p",[t._v("获取信号的方式有很多种：")]),t._v(" "),s("ul",[s("li",[t._v("创建单元信号")]),t._v(" "),s("li",[t._v("创建动态信号")]),t._v(" "),s("li",[t._v("通过 Cocoa 桥接")]),t._v(" "),s("li",[t._v("从别的信号变换而来")]),t._v(" "),s("li",[t._v("由序列变换而来")])]),t._v(" "),s("p",[s("strong",[t._v("单元信号")])]),t._v(" "),s("p",[t._v("最简单的信号是单元信号，有 4 种：")]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// return信号：被订阅后，立马产生一个值事件，然后产生一个完成事件")]),t._v("\nRACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("signal1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("someObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// error信号：被订阅后，立马产生一个错误事件")]),t._v("\nRACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("signal2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RACSignal error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("someError"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// empty信号：被订阅后，立马产生一个完成事件")]),t._v("\nRACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("signal3 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RACSignal empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// never信号：永远不产生事件")]),t._v("\nRACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("signal4 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RACSignal never"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("可以用图例描述这 4 个信号：")]),t._v(" "),s("e-img",{attrs:{src:"/image/return-error-empty-never@2x.png"}}),t._v(" "),s("p",[s("strong",[t._v("动态信号")])]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("signal5 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RACSignal createSignal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),t._v("RACDisposable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("RACSubscriber"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" subscriber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("subscriber sendNext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("subscriber sendNext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("subscriber sendCompleted"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RACDisposable disposableWithBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("Cocoa 桥接")])]),t._v(" "),s("p",[t._v("RAC 为大量的 Cocoa 类型提供便捷的信号桥接工具，如下是一些常见的桥接方式：")]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("signal6 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("object rac_signalForSelector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("setFrame"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nRACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("signal7 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("control rac_signalForControlEvents"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("UIControlEventTouchUpInside"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nRACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("signal8 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("object rac_willDeallocSignal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nRACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("signal9 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("RACObserve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" keyPath"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 还有更多")]),t._v("\n")])])]),s("p",[s("strong",[t._v("信号变换")])]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("signal10 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("signal1 map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" someObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("序列变换")])]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("signal11 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sequence"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("signal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"订阅信号"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#订阅信号"}},[t._v("#")]),t._v(" 订阅信号")]),t._v(" "),s("p",[t._v("订阅信号的方式有 3 种：")]),t._v(" "),s("ul",[s("li",[t._v("通过"),s("code",[t._v("subscribeNext:error:completed:")]),t._v("方法订阅")]),t._v(" "),s("li",[t._v("RAC 宏绑定")]),t._v(" "),s("li",[t._v("Cocoa 桥接")])]),t._v(" "),s("p",[s("strong",[t._v("通过"),s("code",[t._v("subscribeNext:error:completed:")]),t._v("方法订阅")])]),t._v(" "),s("p",[s("code",[t._v("subscribeNext:error:completed:")]),t._v("是最基础的信号订阅方法，相关的方法原型如下：")]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACDisposable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("subscribeNext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("nextBlock\n                           error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSError "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("errorBlock\n                       completed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("RAC 宏绑定")])]),t._v(" "),s("p",[t._v("可以使用"),s("code",[t._v("RAC()")]),t._v("宏（和上述的"),s("code",[t._v("RACObserve()")]),t._v("宏不一样）绑定：")]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("RAC")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("view"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" backgroundColor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" signal10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 每当signal10产生一个值事件，就将view.backgroundColor设为相应的值")]),t._v("\n")])])]),s("p",[s("strong",[t._v("Cocoa 桥接")])]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("object rac_liftSelector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("someSelector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" withSignals"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("signal1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" signal2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("object rac_liftSelector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("someSelector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" withSignalsFromArray"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("@")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("signal1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" signal2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("object rac_liftSelector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("someSelector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" withSignalOfArguments"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("signal1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"订阅过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#订阅过程"}},[t._v("#")]),t._v(" 订阅过程")]),t._v(" "),s("p",[t._v("所谓订阅过程指的是信号被订阅的处理逻辑，如下是简单的例子：")]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("signal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RACSignal createSignal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),t._v("RACDisposable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("RACSubscriber"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" subscriber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("subscriber sendNext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("subscriber sendNext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("subscriber sendCompleted"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("subscriber sendNext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"3"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 无效")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RACDisposable disposableWithBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSLog")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"dispose"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当错误事件或者完成事件产生时，该block被调用")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("signal subscribeNext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSLog")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"next value is :  %@"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSError "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSLog")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"error : %@"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" completed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSLog")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"completed"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* prints:\nnext value is :  1\nnext value is :  2\ncompleted\ndispose\n*/")]),t._v("\n")])])]),s("h2",{attrs:{id:"信号的各类操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#信号的各类操作"}},[t._v("#")]),t._v(" 信号的各类操作")]),t._v(" "),s("p",[t._v("这一部分将介绍信号的各类操作，内容比较多。将信号的操作分为两类：单个信号的变换、多个信号的组合。")]),t._v(" "),s("h3",{attrs:{id:"单个信号的变换"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#单个信号的变换"}},[t._v("#")]),t._v(" 单个信号的变换")]),t._v(" "),s("p",[t._v("单个信号的变换也可以分为几类：")]),t._v(" "),s("ul",[s("li",[t._v("值操作")]),t._v(" "),s("li",[t._v("数量操作")]),t._v(" "),s("li",[t._v("时间操作")])]),t._v(" "),s("p",[t._v("下文结合图例对各种操作进行说明。")]),t._v(" "),s("p",[s("strong",[t._v("值操作 -- Map")])]),t._v(" "),s("e-img",{attrs:{src:"/image/map@2x.png"}}),t._v(" "),s("ul",[s("li",[t._v("当"),s("code",[t._v("signalA")]),t._v("事件流出现完成事件时，"),s("code",[t._v("signalB")]),t._v("的事件流也会出现完成事件")]),t._v(" "),s("li",[t._v("当"),s("code",[t._v("signalA")]),t._v("事件流出现错误事件时，"),s("code",[t._v("signalB")]),t._v("也会将该错误原封不动地释放出来")])]),t._v(" "),s("p",[s("code",[t._v("map:")]),t._v("操作还有一个简化版："),s("code",[t._v("mapReplace:")]),t._v("，"),s("code",[t._v("[signalA mapReplace:@886];")]),t._v("等价于"),s("code",[t._v("[signalA map:^id(id value) { return @886; }];")]),t._v("。")]),t._v(" "),s("p",[s("strong",[t._v("值操作 -- ReduceEach")])]),t._v(" "),s("e-img",{attrs:{src:"/image/reduce-each@2x.png"}}),t._v(" "),s("p",[s("code",[t._v("reduceEach:")]),t._v("这个操作的名字不太容易理解，但是操作本身还是非常简单，是"),s("code",[t._v("map:")]),t._v("的变体。当"),s("code",[t._v("signalA")]),t._v("的值事件包裹的数据是"),s("code",[t._v("RACTuple")]),t._v("类型时，才可以使用该操作；稍微读一下该操作的实现源码即可明白。")]),t._v(" "),s("p",[t._v("此外，"),s("code",[t._v("reduceEach:")]),t._v("的 block 中，可以传入的参数是任意数量。")]),t._v(" "),s("p",[t._v("P.S: 如何理解「reduce」？")]),t._v(" "),s("p",[s("strong",[t._v("值操作 -- 其他的 Map 变体操作")])]),t._v(" "),s("p",[t._v("除了"),s("code",[t._v("reduceEach:")]),t._v("，"),s("code",[t._v("map:")]),t._v("还有其他的一些变体操作：")]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("not"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("and"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("or"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("reduceApply"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("前面 3 个都比较容易理解，"),s("code",[t._v("reduceApply")]),t._v("也要求值事件包裹的数据类型是"),s("code",[t._v("RACTuple")]),t._v("，并且该"),s("code",[t._v("RACTuple")]),t._v("的第一个元素是一个 block，后面的元素作为该 block 的参数传入，返回该 block 的执行结果。")]),t._v(" "),s("p",[s("strong",[t._v("值操作 -- Materialize 和 Dematerialize")])]),t._v(" "),s("p",[t._v("对于"),s("code",[t._v("signalB = [signalA materialize];")]),t._v("，"),s("code",[t._v("signalA")]),t._v("产生的值事件包裹的数据都被转化为"),s("code",[t._v("RACEvent")]),t._v("对象，错误事件和完成事件亦然：")]),t._v(" "),s("div",{staticClass:"language-textile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-textile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token phrase"}},[t._v("signalA -- sendNext:x\n=>\nsignalB -- sendNext:[RACEvent eventWithValue:x]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token phrase"}},[t._v("signalA -- sendError:error\n=>\nsignalB --  sendNext:[RACEvent eventWithError:error]\nsignalB --  sendCompleted")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token phrase"}},[t._v("signalA -- sendCompleted\n=>\nsignalB -- sendNext:RACEvent.completedEvent\nsignalB -- sendCompleted\n")])])])]),s("p",[s("code",[t._v("dematerialize")]),t._v("操作与"),s("code",[t._v("materialize")]),t._v("相反，写代码体会一下就明白了。这两个操作似乎很少被用到。")]),t._v(" "),s("p",[s("strong",[t._v("数量操作 -- Filter")])]),t._v(" "),s("e-img",{attrs:{src:"/image/filter@2x.png"}}),t._v(" "),s("p",[t._v("和"),s("code",[t._v("map:")]),t._v("一样：")]),t._v(" "),s("ul",[s("li",[t._v("当"),s("code",[t._v("signalA")]),t._v("产生完成事件时，"),s("code",[t._v("signalB")]),t._v("也会产生完成事件")]),t._v(" "),s("li",[t._v("当"),s("code",[t._v("signalA")]),t._v("产生错误事件时，"),s("code",[t._v("signalB")]),t._v("也会将该错误原封不动地释放出来")])]),t._v(" "),s("p",[s("strong",[t._v("数量操作 -- Ignore")])]),t._v(" "),s("p",[s("code",[t._v("ignore:")]),t._v("是"),s("code",[t._v("filter:")]),t._v("的变体操作：")]),t._v(" "),s("e-img",{attrs:{src:"/image/ignore@2x.png"}}),t._v(" "),s("p",[t._v("还有其他的变体版本：")]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("ignoreValues"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("数量操作 -- Distinct")])]),t._v(" "),s("p",[s("code",[t._v("distinctUntilChanged")]),t._v("去掉连续相同的值事件。")]),t._v(" "),s("e-img",{attrs:{src:"/image/distinct-until-changed@2x.png"}}),t._v(" "),s("p",[s("strong",[t._v("数量操作 -- Take 和 Skip")])]),t._v(" "),s("p",[s("code",[t._v("take:")]),t._v("操作只取前"),s("code",[t._v("n")]),t._v("（传入的参数）个事件。")]),t._v(" "),s("e-img",{attrs:{src:"/image/take@2x.png"}}),t._v(" "),s("p",[t._v("假设"),s("code",[t._v("signalA")]),t._v("第一次出现错误事件/完成事件的 index（从 1 开始）为"),s("code",[t._v("k")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("当"),s("code",[t._v("k")]),t._v(" > "),s("code",[t._v("n")]),t._v("时，"),s("code",[t._v("signalB")]),t._v("中就不会出现错误事件/完成事件")]),t._v(" "),s("li",[t._v("当"),s("code",[t._v("k")]),t._v(" <= "),s("code",[t._v("n")]),t._v("时，错误事件/完成事件也会出现"),s("code",[t._v("signalB")]),t._v("中")])]),t._v(" "),s("p",[s("code",[t._v("skip:")]),t._v("与"),s("code",[t._v("take:")]),t._v("相反，它会将前"),s("code",[t._v("n")]),t._v("（传入的参数）个事件给过过滤掉。")]),t._v(" "),s("e-img",{attrs:{src:"/image/skip@2x.png"}}),t._v(" "),s("p",[s("code",[t._v("signalA")]),t._v("的前"),s("code",[t._v("n")]),t._v("个事件中可能会出现错误事件/完成事件，这种情况下，"),s("code",[t._v("signalB")]),t._v("的第一个信号就是错误事件/完成事件，且不会有任何的值事件。")]),t._v(" "),s("p",[s("code",[t._v("take:")]),t._v("和"),s("code",[t._v("skip:")]),t._v("也有几个变体：")]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("takeLast"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSUInteger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("takeUntilBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BOOL "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("predicate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("takeWhileBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BOOL "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("predicate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("skipUntilBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BOOL "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("predicate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("skipWhileBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BOOL "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("predicate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("P.S: 还有两个操作也以「take」作为前缀，即"),s("code",[t._v("takeUntil:")]),t._v("和"),s("code",[t._v("takeUntilReplacement:")]),t._v("，但属于组合操作，详见下文。")]),t._v(" "),s("p",[s("strong",[t._v("数量操作 -- Start With")])]),t._v(" "),s("p",[s("code",[t._v("startWith:")]),t._v("操作的作用是在事件流的开始新增一个值事件。")]),t._v(" "),s("e-img",{attrs:{src:"/image/start-with@2x.png"}}),t._v(" "),s("p",[s("strong",[t._v("数量操作 -- Repeat")])]),t._v(" "),s("e-img",{attrs:{src:"/image/repeat@2x.png"}}),t._v(" "),s("p",[t._v("从图中可以看到，"),s("code",[t._v("repeat")]),t._v("操作会忽略"),s("code",[t._v("signalA")]),t._v("的完成事件，但它不会忽略错误事件，换句话说，如果"),s("code",[t._v("signalA")]),t._v("的事件流中含有错误事件，那么"),s("code",[t._v("signalB")]),t._v("的事件流会和"),s("code",[t._v("signalA")]),t._v("完全一致。")]),t._v(" "),s("p",[s("strong",[t._v("数量操作 -- Retry")])]),t._v(" "),s("e-img",{attrs:{src:"/image/retry@2x.png"}}),t._v(" "),s("p",[t._v("然而，当"),s("code",[t._v("signalA")]),t._v("事件流中含有完成事件时，那么"),s("code",[t._v("signalA")]),t._v("的事件流会和"),s("code",[t._v("signalA")]),t._v("完全一致。")]),t._v(" "),s("p",[s("code",[t._v("retry")]),t._v("操作还有带参数版本"),s("code",[t._v("retry:")]),t._v("，该版本可以指定次数。这种操作在处理网络任务时非常有用。")]),t._v(" "),s("p",[s("strong",[t._v("数量操作 -- Collect")])]),t._v(" "),s("e-img",{attrs:{src:"/image/collect@2x.png"}}),t._v(" "),s("p",[s("strong",[t._v("Aggregate 和 Scan")])]),t._v(" "),s("p",[t._v("Aggregate（译作「合计」）和 Scan 这两个操作有些类似，但明显有区别，前者改变了事件流的事件数量，后者没有，看如下图例就明白。")]),t._v(" "),s("e-img",{attrs:{src:"/image/aggregate@2x.png"}}),t._v(" "),s("e-img",{attrs:{src:"/image/scan@2x.png"}}),t._v(" "),s("p",[t._v("Aggregate 和 Scan 还有一些其他变种方法：")]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("aggregateWithStartFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("startFactory reduce"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id running"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id next"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("reduceBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("aggregateWithStart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("start reduceWithIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NSUInteger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("reduceBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("scanWithStart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("startingValue reduceWithIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NSUInteger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("reduceBlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("时间操作 -- 常会用到的时间信号")])]),t._v(" "),s("p",[t._v("经常会有这样的需求：定时产生一个事件。")]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("interval"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSTimeInterval"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("interval onScheduler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACScheduler "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("scheduler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("interval"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSTimeInterval"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("interval onScheduler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACScheduler "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("scheduler withLeeway"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSTimeInterval"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("leeway"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("这两个类方法都会产生一个时间信号，时间信号会以一定频率产生一个值事件，值事件包裹的是"),s("code",[t._v("NSDate")]),t._v("对象。第二个方法中的参数"),s("code",[t._v("leeway")]),t._v("是「缓冲」、「余地」的意思，还不太明白其作用。")]),t._v(" "),s("p",[s("strong",[t._v("时间操作 -- Delay")])]),t._v(" "),s("e-img",{attrs:{src:"/image/delay@2x.png"}}),t._v(" "),s("p",[s("strong",[t._v("时间操作 -- Throttle")])]),t._v(" "),s("p",[t._v("Throttle 信号理解起来相对比较繁琐些。在下图中，"),s("code",[t._v("signalA")]),t._v("事件流中一共有 5 个值事件和 1 个完成事件，其中 1 号和 2 号事件间隔 2s，2、3、4 号事件间隔 1s，5 号值事件比 4 号值事件晚 3s，完成事件比 5 号事件晚 1s。")]),t._v(" "),s("e-img",{attrs:{src:"/image/throttle@2x.png"}}),t._v(" "),s("p",[s("code",[t._v("signalB")]),t._v("由"),s("code",[t._v("[signalA throttle:1.5]")]),t._v("得到，throttle 表示门限，其作用效果是：")]),t._v(" "),s("ul",[s("li",[t._v("当"),s("code",[t._v("signalA")]),t._v("事件流产生一个值事件时，若 1.5s 内没有其他的值事件产生，则"),s("code",[t._v("signalB")]),t._v("事件流中也会产生该值事件；比如上图中的 1 号值事件，下一个值事件（2 号）在其 2s 后产生，满足要求，故而在 1.5s 后，"),s("code",[t._v("signalB")]),t._v("的事件流也产生该信号；")]),t._v(" "),s("li",[t._v("当"),s("code",[t._v("signalA")]),t._v("事件流产生一个值事件时，若 1.5s 内有其他的值事件产生，则"),s("code",[t._v("signalB")]),t._v("会过滤掉该值事件；比如上图中的 2 号和 3 号值事件，在 1s 后分别有 3 号和 4 号信号产生，不满足要求，故而都不会出现在"),s("code",[t._v("signalB")]),t._v("的事件流中；")]),t._v(" "),s("li",[t._v("对于"),s("code",[t._v("signalA")]),t._v("中的最后一个值事件，"),s("code",[t._v("signalB")]),t._v("事件流中总会也包含它。")])]),t._v(" "),s("p",[t._v("这种信号有什么用呢？有一个常用的应用场景：在 App 内经常需要搜索，为了确保实时性，简单的做法是每输入一个字符就检索一下，但是若用户输入字符比较快，这种检索策略会比较浪费流量，因此比较好的做法是，用户输入某个字符后，1s（参考值）内没有再输入别的字符，就检索一次搜索结果。此时 throttle 就有了用武之地。")]),t._v(" "),s("p",[s("code",[t._v("throttle:")]),t._v("还有一个变体"),s("code",[t._v("throttle:valuesPassingTest:")]),t._v("；及类似操作："),s("code",[t._v("bufferWithTime:onScheduler:")]),t._v("。")]),t._v(" "),s("p",[s("strong",[t._v("副作用操作")])]),t._v(" "),s("p",[t._v("再补充一些 RAC 提供的副作用操作：")]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("doNext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("block"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("doError"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSError "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("block"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("doCompleted"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("block"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("initially"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("block"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RACSignal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("finally"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("block"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("这 5 个副作用操作，稍微查看一下源码立马能知道它们的作用；其中"),s("code",[t._v("initially:")]),t._v("的作用是让信号在第一次被订阅是调用其 block；"),s("code",[t._v("finally:")]),t._v("的作用是在信号的事件流结束（出现完成事件或错误事件）时调用传入的 block。")]),t._v(" "),s("h3",{attrs:{id:"多个信号的组合"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#多个信号的组合"}},[t._v("#")]),t._v(" 多个信号的组合")]),t._v(" "),s("p",[t._v("上面介绍的都是单信号操作，这部分介绍多信号组合操作，在熟悉这些组合操作时，以"),s("code",[t._v("signalA + signalB => signalC")]),t._v("为例，需要留意几个问题：")]),t._v(" "),s("ul",[s("li",[t._v("组合得到"),s("code",[t._v("signalC")]),t._v("的信号受哪个信号终止而终止，"),s("code",[t._v("signalA")]),t._v(" or "),s("code",[t._v("signalB")]),t._v("？")]),t._v(" "),s("li",[t._v("当"),s("code",[t._v("signalA")]),t._v("或"),s("code",[t._v("signalB")]),t._v("事件流中出现错误信号，会如何？")]),t._v(" "),s("li",[t._v("各个信号何时开始被订阅？")])]),t._v(" "),s("p",[s("strong",[t._v("组合操作 -- Concat")])]),t._v(" "),s("e-img",{attrs:{src:"/image/concat@2x.png"}}),t._v(" "),s("p",[t._v("在上图中，当"),s("code",[t._v("signalA")]),t._v("的事件流中出现完成事件时，立马订阅"),s("code",[t._v("signalB")]),t._v("，"),s("code",[t._v("signalC")]),t._v("事件流的完成事件与"),s("code",[t._v("signalB")]),t._v("的完成事件对应。同时，注意到当"),s("code",[t._v("signalA")]),t._v("中出现错误事件时，"),s("code",[t._v("signalC")]),t._v("中的事件流与"),s("code",[t._v("signalA")]),t._v("的事件流完全保持一致，就没"),s("code",[t._v("signalB")]),t._v("什么事儿了。")]),t._v(" "),s("p",[s("strong",[t._v("组合操作 -- Merge")])]),t._v(" "),s("p",[t._v("Merge 操作比较简单，看图就明白。")]),t._v(" "),s("e-img",{attrs:{src:"/image/merge@2x.png"}}),t._v(" "),s("p",[t._v("除了"),s("code",[t._v("signalC = [signalA merge:signalB]")]),t._v("这种用法外，还可以这样：")]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("signalC "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RACSignal merge"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("@")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("signalA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" signalB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsignalC "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RACSignal merge"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("RACTuplePack")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("signalA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" signalB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("组合操作 -- Zip")])]),t._v(" "),s("e-img",{attrs:{src:"/image/zip@2x.png"}}),t._v(" "),s("p",[t._v("除了"),s("code",[t._v("signalC = [signalA zip:signalB]")]),t._v("这种用法外，还可以这样：")]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("signalC "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RACSignal zip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("@")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("signalA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" signalB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsignalC "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RACSignal zip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("RACTuplePack")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("signalA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" signalB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("组合操作 -- CombineLatest")])]),t._v(" "),s("e-img",{attrs:{src:"/image/combine-latest@2x.png"}}),t._v(" "),s("p",[t._v("除了"),s("code",[t._v("signalC = [signalA combineLatest:signalB]")]),t._v("这种用法外，还可以这样：")]),t._v(" "),s("div",{staticClass:"language-objectivec extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objectivec"}},[s("code",[t._v("signalC "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RACSignal combineLatest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("@")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("signalA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" signalB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsignalC "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RACSignal combineLatest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("RACTuplePack")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("signalA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" signalB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("组合操作 -- Sample")])]),t._v(" "),s("e-img",{attrs:{src:"/image/sample@2x.png"}}),t._v(" "),s("p",[t._v("在"),s("code",[t._v("signalC = [signalA sample:signalB]")]),t._v("中，"),s("code",[t._v("signalB")]),t._v("充当"),s("code",[t._v("signalA")]),t._v("的采样信号，一旦"),s("code",[t._v("signalA")]),t._v("或"),s("code",[t._v("signalB")]),t._v("先产生完成事件或者错误事件，"),s("code",[t._v("signalC")]),t._v("的事件流就被终止。")]),t._v(" "),s("p",[s("strong",[t._v("组合操作 -- Take Until")])]),t._v(" "),s("e-img",{attrs:{src:"/image/take-until@2x.png"}}),t._v(" "),s("p",[s("code",[t._v("signalC")]),t._v("事件流中的事件和"),s("code",[t._v("signalA")]),t._v("一一对应，直到"),s("code",[t._v("signalB")]),t._v("事件流中出现了信号，事件流就终结。")]),t._v(" "),s("p",[s("strong",[t._v("组合操作 -- Take Until Replacement")])]),t._v(" "),s("e-img",{attrs:{src:"/image/take-until-replacement@2x.png"}}),t._v(" "),s("p",[s("code",[t._v("signalC")]),t._v("事件流中的事件和"),s("code",[t._v("signalA")]),t._v("一一对应，一旦"),s("code",[t._v("signalB")]),t._v("事件流中出现了信号，"),s("code",[t._v("signalC")]),t._v("的事件就和"),s("code",[t._v("signalB")]),t._v("形成呼应，当然前提是"),s("code",[t._v("signalC")]),t._v("的事件流还没有终结。")]),t._v(" "),s("p",[t._v("补充：本文的主体内容是我在刚入职场学习 ReactiveCocoa 时的笔记，当时在闲得蛋疼和郁闷的情况下，画了很多 operator 图例打发时间；然而罗列的信号的基本操作并不全，一些高阶操作（譬如 flatten）没有涉及到。ReactiveX 定义了更多更全的 operator，并配有详细说明，详见"),s("a",{attrs:{href:"http://reactivex.io/documentation/operators.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),s("OutboundLink")],1),t._v("，ReactiveCocoa 受 ReactiveX 启发，后者定义的 operator 在 ReactiveCocoa 基本都有实现，可以作为参考。另外，"),s("a",{attrs:{href:"http://rxmarbles.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("RxJS Marbles"),s("OutboundLink")],1),t._v("提供的可交互 signal 操作能更生动地帮助理解各个 operator 的内涵。")])],1)}),[],!1,null,null,null);a.default=e.exports}}]);